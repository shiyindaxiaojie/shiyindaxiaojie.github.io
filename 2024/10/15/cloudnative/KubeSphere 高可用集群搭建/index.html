<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>KubeSphere 高可用集群搭建 | 梦想歌の网络日志</title><meta name="author" content="梦想歌"><meta name="copyright" content="梦想歌"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="背景介绍笔者最近在部署自建机房，准备搭建 KubeSphere 集群，KubeSphere 官网的文档似乎有点小问题，所以用这篇文章来记录一下实际的操作，可以放心食用。 准备环境假设有 4 台机器节点，规划如下：  10.2.2.109：控制节点和 etcd 10.2.2.140：数据节点1 10.2.2.211：数据节点2 10.2.1.9: NFS 服务器，与 KubeSphere 集群隔离">
<meta property="og:type" content="article">
<meta property="og:title" content="KubeSphere 高可用集群搭建">
<meta property="og:url" content="https://mengxiangge.netlify.app/2024/10/15/cloudnative/KubeSphere%20%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/index.html">
<meta property="og:site_name" content="梦想歌の网络日志">
<meta property="og:description" content="背景介绍笔者最近在部署自建机房，准备搭建 KubeSphere 集群，KubeSphere 官网的文档似乎有点小问题，所以用这篇文章来记录一下实际的操作，可以放心食用。 准备环境假设有 4 台机器节点，规划如下：  10.2.2.109：控制节点和 etcd 10.2.2.140：数据节点1 10.2.2.211：数据节点2 10.2.1.9: NFS 服务器，与 KubeSphere 集群隔离">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/shiyindaxiaojie/images/cover/KubeSphere.png">
<meta property="article:published_time" content="2024-10-15T07:05:01.000Z">
<meta property="article:modified_time" content="2025-01-14T09:08:23.023Z">
<meta property="article:author" content="梦想歌">
<meta property="article:tag" content="自建机房">
<meta property="article:tag" content="Kubernetes">
<meta property="article:tag" content="高可用集群">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/shiyindaxiaojie/images/cover/KubeSphere.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "KubeSphere 高可用集群搭建",
  "url": "https://mengxiangge.netlify.app/2024/10/15/cloudnative/KubeSphere%20%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/",
  "image": "https://cdn.jsdelivr.net/gh/shiyindaxiaojie/images/cover/KubeSphere.png",
  "datePublished": "2024-10-15T07:05:01.000Z",
  "dateModified": "2025-01-14T09:08:23.023Z",
  "author": [
    {
      "@type": "Person",
      "name": "梦想歌",
      "url": "https://github.com/shiyindaxiaojie"
    }
  ]
}</script><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/shiyindaxiaojie/images/hexo/favicon.ico"><link rel="canonical" href="https://mengxiangge.netlify.app/2024/10/15/cloudnative/KubeSphere%20%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.1"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"pagination":{"enable":true,"hitsPerPage":8},"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":true,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'KubeSphere 高可用集群搭建',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="loading-container"><div class="genshin-loading"><div class="elements-row"><img class="element-icon fire" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/img/genshin/loading/fire.png" alt="火元素"/ loading='lazy'><img class="element-icon water" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/img/genshin/loading/water.png" alt="水元素"/ loading='lazy'><img class="element-icon wind" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/img/genshin/loading/wind.png" alt="风元素"/ loading='lazy'><img class="element-icon elec" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/img/genshin/loading/elec.png" alt="雷元素"/ loading='lazy'><img class="element-icon grass" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/img/genshin/loading/grass.png" alt="草元素"/ loading='lazy'><img class="element-icon ice" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/img/genshin/loading/ice.png" alt="冰元素"/ loading='lazy'><img class="element-icon rock" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/img/genshin/loading/rock.png" alt="岩元素"/ loading='lazy'></div><div class="loading-text">加载中...</div></div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const $elementIcons = $loadingBox.querySelectorAll('.element-icon')
  const $loadingText = $loadingBox.querySelector('.loading-text')

  // 原神七元素加载顺序：火、水、风、雷、草、冰、岩
  const elementClasses = ['fire', 'water', 'wind', 'elec', 'grass', 'ice', 'rock']
  const loadingMessages = [
    '火元素加载中...',
    '水元素加载中...',
    '风元素加载中...',
    '雷元素加载中...',
    '草元素加载中...',
    '冰元素加载中...',
    '岩元素加载中...'
  ]

  let currentStep = 0
  let loadingInterval = null

  const startSequentialLoading = () => {
    currentStep = 0

    // 清除之前的定时器
    if (loadingInterval) {
      clearInterval(loadingInterval)
    }

    // 依次显示每个元素 - 每150ms从左到右让图标不透明
    loadingInterval = setInterval(() => {
      if (currentStep < $elementIcons.length) {
        // 添加visible类来让图标不透明
        $elementIcons[currentStep].classList.add('visible')

        currentStep++
      } else {
        clearInterval(loadingInterval)
        loadingInterval = null

        // 动画播放完成后，直接进入主页面
        preloader.endLoading()
      }
    }, 150) // 每150毫秒显示一个元素
  }

  const preloader = {
    endLoading: () => {
      if ($loadingBox.classList.contains('loaded')) return

      // 清除加载定时器
      if (loadingInterval) {
        clearInterval(loadingInterval)
        loadingInterval = null
      }

      // 确保所有元素都变为不透明
      $elementIcons.forEach(icon => {
        icon.classList.add('visible')
      })

      // 立即进入主页面
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')

      // 重置所有元素状态 - 移除visible类
      $elementIcons.forEach(icon => {
        icon.classList.remove('visible')
      })

      startSequentialLoading()
    }
  }

  preloader.initLoading()

  // 超时保护：3秒后强制结束
  setTimeout(() => {
    if (!$loadingBox.classList.contains('loaded')) {
      preloader.endLoading()
    }
  }, 3000)

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/shiyindaxiaojie/images/hexo/avatar.png" onerror="this.onerror=null;this.src='https://cdn.jsdelivr.net/gh/shiyindaxiaojie/images/hexo/friend_404.gif'" alt="avatar"/ loading='lazy'></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">51</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">79</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 博客</span></a></div><div class="menus_item"><a class="site-page" href="/tools/"><i class="fa-fw fas fa-tools"></i><span> 工具</span></a></div><div class="menus_item"><a class="site-page" href="/about"><i class="fa-fw fas fa-user"></i><span> 关于</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 列表</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://cdn.jsdelivr.net/gh/shiyindaxiaojie/images/cover/KubeSphere.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">梦想歌の网络日志</span></a><a class="nav-page-title" href="/"><span class="site-name">KubeSphere 高可用集群搭建</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 博客</span></a></div><div class="menus_item"><a class="site-page" href="/tools/"><i class="fa-fw fas fa-tools"></i><span> 工具</span></a></div><div class="menus_item"><a class="site-page" href="/about"><i class="fa-fw fas fa-user"></i><span> 关于</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 列表</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">KubeSphere 高可用集群搭建</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-10-15T07:05:01.000Z" title="发表于 2024-10-15 15:05:01">2024-10-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-01-14T09:08:23.023Z" title="更新于 2025-01-14 17:08:23">2025-01-14</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%B9%B3%E5%8F%B0%E5%B7%A5%E7%A8%8B/">平台工程</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="背景介绍"><a href="#背景介绍" class="headerlink" title="背景介绍"></a>背景介绍</h1><p>笔者最近在部署自建机房，准备搭建 KubeSphere 集群，KubeSphere 官网的文档似乎有点小问题，所以用这篇文章来记录一下实际的操作，可以放心食用。</p>
<h1 id="准备环境"><a href="#准备环境" class="headerlink" title="准备环境"></a>准备环境</h1><p>假设有 4 台机器节点，规划如下：</p>
<ul>
<li>10.2.2.109：控制节点和 etcd</li>
<li>10.2.2.140：数据节点1</li>
<li>10.2.2.211：数据节点2</li>
<li>10.2.1.9: NFS 服务器，与 KubeSphere 集群隔离 IP 网段</li>
</ul>
<h2 id="DNS-初始化"><a href="#DNS-初始化" class="headerlink" title="DNS 初始化"></a>DNS 初始化</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">cat</span> /etc/hosts</span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line"></span><br><span class="line">10.2.2.109      k3s-master      k3s-master.novalocal</span><br><span class="line">10.2.2.140      k3s-worker-01   k3s-worker-01.novalocal</span><br><span class="line">10.2.2.211      k3s-worker-02   k3s-worker-02.novalocal</span><br></pre></td></tr></table></figure>

<h2 id="NFS-初始化"><a href="#NFS-初始化" class="headerlink" title="NFS 初始化"></a>NFS 初始化</h2><p>容器重启后数据会丢失，建议您提前部署好一个 NFS 存储，作为 Kubernetes 的默认存储类。</p>
<p>在所有服务器节点执行。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; yum install -y nfs-common</span><br><span class="line">&gt; yum upgrade -y</span><br><span class="line">&gt; vgcreate containervg /dev/vdb</span><br><span class="line">&gt; lvcreate -n container -l 100%FREE containervg</span><br><span class="line">&gt; mkfs.xfs /dev/mapper/containervg-container</span><br><span class="line">&gt; vi /etc/fstab</span><br><span class="line">/dev/mapper/containervg-container /var/lib/containerd xfs     defaults        0 0</span><br><span class="line">&gt; mount -a</span><br><span class="line">&gt; yum install -y socat conntrack ebtables ipset ipvsadm</span><br></pre></td></tr></table></figure>

<p>在服务器节点 10.2.1.9 执行。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">&gt; parted /dev/sda</span><br><span class="line">Using /dev/sda</span><br><span class="line">Welcome to GNU Parted! Type <span class="string">&#x27;help&#x27;</span> to view a list of commands.</span><br><span class="line">(parted) <span class="built_in">print</span></span><br><span class="line">Model: DELL PERC H330 Mini (scsi)</span><br><span class="line">Disk /dev/sda: 6000GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: gpt</span><br><span class="line">Disk Flags: pmbr_boot</span><br><span class="line"></span><br><span class="line">Number  Start   End     Size    File system  Name            Flags</span><br><span class="line"> 1      1049kB  3146kB  2097kB                               bios_grub</span><br><span class="line"> 2      3146kB  2151MB  2147MB  xfs</span><br><span class="line"> 3      2151MB  110GB   107GB                                lvm</span><br><span class="line"> 4      110GB   2000GB  1890GB               cinder-volumes  lvm</span><br><span class="line"> 5      2000GB  2500GB  500GB                image-volume    lvm</span><br><span class="line"> 6      2500GB  3000GB  500GB                backup-volume   lvm</span><br><span class="line"> 7      3000GB  3500GB  500GB                nova-volume     lvm</span><br><span class="line"></span><br><span class="line">(parted) mkpart k3s-nfs xfs 3500GB 5500GB</span><br><span class="line">(parted) <span class="built_in">set</span> 8 lvm on</span><br><span class="line">(parted) <span class="built_in">print</span></span><br><span class="line">Model: DELL PERC H330 Mini (scsi)</span><br><span class="line">Disk /dev/sda: 6000GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: gpt</span><br><span class="line">Disk Flags: pmbr_boot</span><br><span class="line"></span><br><span class="line">Number  Start   End     Size    File system  Name            Flags</span><br><span class="line"> 1      1049kB  3146kB  2097kB                               bios_grub</span><br><span class="line"> 2      3146kB  2151MB  2147MB  xfs</span><br><span class="line"> 3      2151MB  110GB   107GB                                lvm</span><br><span class="line"> 4      110GB   2000GB  1890GB               cinder-volumes  lvm</span><br><span class="line"> 5      2000GB  2500GB  500GB                image-volume    lvm</span><br><span class="line"> 6      2500GB  3000GB  500GB                backup-volume   lvm</span><br><span class="line"> 7      3000GB  3500GB  500GB                nova-volume     lvm</span><br><span class="line"> 8      3500GB  5500GB  2000GB  xfs          k3s-nfs         lvm</span><br><span class="line"></span><br><span class="line">(parted) quit</span><br><span class="line">Information: You may need to update /etc/fstab.</span><br><span class="line"></span><br><span class="line">&gt; udevadm settle</span><br><span class="line">&gt; <span class="built_in">cat</span> /proc/partitions</span><br><span class="line">&gt; vgcreate k3snfsvg /dev/sda8</span><br><span class="line">&gt; lvcreate -n k3snfs -l 100%FREE k3snfsvg</span><br><span class="line">&gt; mkfs.xfs /dev/mapper/k3snfsvg-k3snfs</span><br><span class="line">&gt; <span class="built_in">mkdir</span> -p /nfs/kubesphere</span><br><span class="line">&gt; vim /etc/fstab</span><br><span class="line">/dev/mapper/k3snfsvg-k3snfs /nfs/kubesphere xfs     defaults        0 0</span><br><span class="line"></span><br><span class="line">&gt; systemctl daemon-reload</span><br><span class="line">&gt; mount -a</span><br><span class="line">&gt; <span class="built_in">df</span> -h</span><br><span class="line">&gt; vim /etc/exports</span><br><span class="line">/nfs/kubesphere   10.0.0.0/8(rw,<span class="built_in">sync</span>,no_root_squash)</span><br><span class="line"></span><br><span class="line">&gt; exportfs -rv</span><br><span class="line">&gt; showmount -e localhost</span><br><span class="line">&gt; <span class="built_in">cd</span> /nfs/kubesphere</span><br><span class="line">&gt; <span class="built_in">mkdir</span> &#123;rootfs,data,<span class="built_in">log</span>,config&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Docker-初始化"><a href="#Docker-初始化" class="headerlink" title="Docker 初始化"></a>Docker 初始化</h2><p>如果 Kubernetes 使用 Containered 作为容器运行时，可以跳过此步骤。</p>
<p>在所有服务器节点执行。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt; yum install -y yum-utils</span><br><span class="line">&gt; yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line">&gt; yum install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</span><br><span class="line">&gt; systemctl <span class="built_in">enable</span> docker.service</span><br><span class="line"><span class="comment"># 如果不支持 VPN，建议设置镜像源为 m.daocloud.io</span></span><br><span class="line">&gt; vim /etc/docker/daemon.json</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://m.daocloud.io&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">&gt; systemctl daemon-reload</span><br><span class="line">&gt; systemctl start docker.service</span><br><span class="line">&gt; systemctl status -l docker.service</span><br></pre></td></tr></table></figure>

<h1 id="部署流程"><a href="#部署流程" class="headerlink" title="部署流程"></a>部署流程</h1><h2 id="Master-节点"><a href="#Master-节点" class="headerlink" title="Master 节点"></a>Master 节点</h2><p>在服务器节点 10.2.2.109 执行。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">export</span> KKZONE=cn</span><br><span class="line">&gt; <span class="built_in">mkdir</span> k3s</span><br><span class="line">&gt; <span class="built_in">cd</span> k3s</span><br><span class="line">&gt; curl -sfL https://get-kk.kubesphere.io | sh -</span><br><span class="line">&gt; sudo <span class="built_in">chmod</span> +x kk</span><br><span class="line">&gt; ./kk version --show-supported-k8s</span><br><span class="line">&gt; ./kk create config --with-kubernetes v1.24.17 --with-kubesphere v3.4.1</span><br><span class="line">&gt; <span class="built_in">cp</span> -p config-sample.yaml config-init.yaml</span><br><span class="line">&gt; vim config-init.yaml</span><br></pre></td></tr></table></figure>

<p>执行 vim nfs-client.yaml 创建 NFS 配置文件，内容如下。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: kubekey.kubesphere.io/v1alpha2</span><br><span class="line">kind: Cluster</span><br><span class="line">metadata:</span><br><span class="line">  name: puyi</span><br><span class="line">spec:</span><br><span class="line">  hosts:</span><br><span class="line">  - &#123;name: k3s-master, address: 10.2.2.109, internalAddress: 10.2.2.109, user: root, password: <span class="string">&quot;k3s-master@123&quot;</span>&#125;</span><br><span class="line">  roleGroups:</span><br><span class="line">    etcd:</span><br><span class="line">    - k3s-master</span><br><span class="line">    control-plane:</span><br><span class="line">    - k3s-master</span><br><span class="line">    worker:</span><br><span class="line">    - k3s-master</span><br><span class="line">  controlPlaneEndpoint:</span><br><span class="line">    domain: lb.kubesphere.local</span><br><span class="line">    address: <span class="string">&quot;&quot;</span></span><br><span class="line">    port: 6443</span><br><span class="line">  kubernetes:</span><br><span class="line">    version: v1.24.17</span><br><span class="line">    clusterName: cluster.local</span><br><span class="line">    autoRenewCerts: <span class="literal">true</span></span><br><span class="line">    containerManager: containerd</span><br><span class="line">    maxPods: 220</span><br><span class="line">  etcd:</span><br><span class="line">    <span class="built_in">type</span>: kubekey</span><br><span class="line">  network:</span><br><span class="line">    plugin: calico</span><br><span class="line">    kubePodsCIDR: 10.233.64.0/18</span><br><span class="line">    kubeServiceCIDR: 10.233.0.0/18</span><br><span class="line">    multusCNI:</span><br><span class="line">      enabled: <span class="literal">false</span></span><br><span class="line">  registry:</span><br><span class="line">    privateRegistry: <span class="string">&quot;&quot;</span></span><br><span class="line">    namespaceOverride: <span class="string">&quot;&quot;</span></span><br><span class="line">    registryMirrors: []</span><br><span class="line">    insecureRegistries: []</span><br><span class="line"><span class="comment"># 这个依赖好像失效了，先注释掉</span></span><br><span class="line"><span class="comment">#  addons: </span></span><br><span class="line"><span class="comment">#  - name: nfs-rootfs</span></span><br><span class="line"><span class="comment">#    namespace: kube-system</span></span><br><span class="line"><span class="comment">#    sources:</span></span><br><span class="line"><span class="comment">#      chart:</span></span><br><span class="line"><span class="comment">#        name: nfs-rootfs-provisioner</span></span><br><span class="line"><span class="comment">#        repo: https://charts.kubesphere.io/main</span></span><br><span class="line"><span class="comment">#        valuesFile: /root/k3s/nfs-client.yaml</span></span><br><span class="line">---</span><br><span class="line">apiVersion: installer.kubesphere.io/v1alpha1</span><br><span class="line">kind: ClusterConfiguration</span><br><span class="line">metadata:</span><br><span class="line">  name: ks-installer</span><br><span class="line">  namespace: kubesphere-system</span><br><span class="line">  labels:</span><br><span class="line">    version: v3.4.1</span><br><span class="line">spec:</span><br><span class="line">  persistence:</span><br><span class="line">    storageClass: <span class="string">&quot;&quot;</span></span><br><span class="line">  authentication:</span><br><span class="line">    jwtSecret: <span class="string">&quot;&quot;</span></span><br><span class="line">  local_registry: <span class="string">&quot;&quot;</span></span><br><span class="line">  etcd:</span><br><span class="line">    monitoring: <span class="literal">false</span></span><br><span class="line">    endpointIps: localhost</span><br><span class="line">    port: 2379</span><br><span class="line">    tlsEnable: <span class="literal">true</span></span><br><span class="line">  common:</span><br><span class="line">    core:</span><br><span class="line">      console:</span><br><span class="line">        enableMultiLogin: <span class="literal">true</span></span><br><span class="line">        port: 30880</span><br><span class="line">        <span class="built_in">type</span>: NodePort</span><br><span class="line">    redis:</span><br><span class="line">      enabled: <span class="literal">false</span></span><br><span class="line">      enableHA: <span class="literal">false</span></span><br><span class="line">      volumeSize: 2Gi</span><br><span class="line">    openldap:</span><br><span class="line">      enabled: <span class="literal">false</span></span><br><span class="line">      volumeSize: 2Gi</span><br><span class="line">    minio:</span><br><span class="line">      volumeSize: 20Gi</span><br><span class="line">    monitoring:</span><br><span class="line">      endpoint: http://prometheus-operated.kubesphere-monitoring-system.svc:9090</span><br><span class="line">      GPUMonitoring:</span><br><span class="line">        enabled: <span class="literal">false</span></span><br><span class="line">    gpu:</span><br><span class="line">      kinds:</span><br><span class="line">      - resourceName: <span class="string">&quot;nvidia.com/gpu&quot;</span></span><br><span class="line">        resourceType: <span class="string">&quot;GPU&quot;</span></span><br><span class="line">        default: <span class="literal">true</span></span><br><span class="line">    es:</span><br><span class="line">      enabled: <span class="literal">false</span></span><br><span class="line">      logMaxAge: 7</span><br><span class="line">      auditingMaxAge: 2</span><br><span class="line">      eventMaxAge: 1</span><br><span class="line">      istioMaxAge: 4</span><br><span class="line">      elkPrefix: logstash</span><br><span class="line">      basicAuth:</span><br><span class="line">        enabled: <span class="literal">false</span></span><br><span class="line">        username: <span class="string">&quot;&quot;</span></span><br><span class="line">        password: <span class="string">&quot;&quot;</span></span><br><span class="line">      externalElasticsearchHost: <span class="string">&quot;&quot;</span></span><br><span class="line">      externalElasticsearchPort: <span class="string">&quot;&quot;</span></span><br><span class="line">    opensearch:</span><br><span class="line">      enabled: <span class="literal">true</span></span><br><span class="line">      logMaxAge: 7</span><br><span class="line">      auditingMaxAge: 2</span><br><span class="line">      eventMaxAge: 1</span><br><span class="line">      istioMaxAge: 4</span><br><span class="line">      opensearchPrefix: whizard</span><br><span class="line">      basicAuth:</span><br><span class="line">        enabled: <span class="literal">true</span></span><br><span class="line">        username: <span class="string">&quot;admin&quot;</span></span><br><span class="line">        password: <span class="string">&quot;admin&quot;</span></span><br><span class="line">      externalOpensearchHost: <span class="string">&quot;&quot;</span></span><br><span class="line">      externalOpensearchPort: <span class="string">&quot;&quot;</span></span><br><span class="line">      dashboard:</span><br><span class="line">        enabled: <span class="literal">false</span></span><br><span class="line">  alerting:</span><br><span class="line">    enabled: <span class="literal">true</span></span><br><span class="line">  auditing:</span><br><span class="line">    enabled: <span class="literal">false</span></span><br><span class="line">  devops:</span><br><span class="line">    enabled: <span class="literal">true</span></span><br><span class="line">    jenkinsCpuReq: 1</span><br><span class="line">    jenkinsCpuLim: 1</span><br><span class="line">    jenkinsMemoryReq: 4Gi</span><br><span class="line">    jenkinsMemoryLim: 4Gi</span><br><span class="line">    jenkinsVolumeSize: 30Gi</span><br><span class="line">  events:</span><br><span class="line">    enabled: <span class="literal">true</span></span><br><span class="line">    ruler:</span><br><span class="line">      enabled: <span class="literal">true</span></span><br><span class="line">      replicas: 2</span><br><span class="line">  logging:</span><br><span class="line">    enabled: <span class="literal">true</span></span><br><span class="line">    logsidecar:</span><br><span class="line">      enabled: <span class="literal">true</span></span><br><span class="line">      replicas: 2</span><br><span class="line">  metrics_server:</span><br><span class="line">    enabled: <span class="literal">true</span></span><br><span class="line">  monitoring:</span><br><span class="line">    storageClass: <span class="string">&quot;&quot;</span></span><br><span class="line">    node_exporter:</span><br><span class="line">      port: 9100</span><br><span class="line">    gpu:</span><br><span class="line">      nvidia_dcgm_exporter:</span><br><span class="line">        enabled: <span class="literal">false</span></span><br><span class="line">  multicluster:</span><br><span class="line">    clusterRole: none</span><br><span class="line">  network:</span><br><span class="line">    networkpolicy:</span><br><span class="line">      enabled: <span class="literal">true</span></span><br><span class="line">    ippool:</span><br><span class="line">      <span class="built_in">type</span>: calico</span><br><span class="line">    topology:</span><br><span class="line">      <span class="built_in">type</span>: weave-scope</span><br><span class="line">  openpitrix:</span><br><span class="line">    store:</span><br><span class="line">      enabled: <span class="literal">true</span></span><br><span class="line">  servicemesh:</span><br><span class="line">    enabled: <span class="literal">false</span></span><br><span class="line">    istio:</span><br><span class="line">      components:</span><br><span class="line">        ingressGateways:</span><br><span class="line">        - name: istio-ingressgateway</span><br><span class="line">          enabled: <span class="literal">false</span></span><br><span class="line">        cni:</span><br><span class="line">          enabled: <span class="literal">false</span></span><br><span class="line">  edgeruntime:</span><br><span class="line">    enabled: <span class="literal">false</span></span><br><span class="line">    kubeedge:</span><br><span class="line">      enabled: <span class="literal">false</span></span><br><span class="line">      cloudCore:</span><br><span class="line">        cloudHub:</span><br><span class="line">          advertiseAddress:</span><br><span class="line">            - <span class="string">&quot;&quot;</span></span><br><span class="line">        service:</span><br><span class="line">          cloudhubNodePort: <span class="string">&quot;30000&quot;</span></span><br><span class="line">          cloudhubQuicNodePort: <span class="string">&quot;30001&quot;</span></span><br><span class="line">          cloudhubHttpsNodePort: <span class="string">&quot;30002&quot;</span></span><br><span class="line">          cloudstreamNodePort: <span class="string">&quot;30003&quot;</span></span><br><span class="line">          tunnelNodePort: <span class="string">&quot;30004&quot;</span></span><br><span class="line">      iptables-manager:</span><br><span class="line">        enabled: <span class="literal">true</span></span><br><span class="line">        mode: <span class="string">&quot;external&quot;</span></span><br><span class="line">  gatekeeper:</span><br><span class="line">    enabled: <span class="literal">false</span></span><br><span class="line">  terminal:</span><br><span class="line">    <span class="built_in">timeout</span>: 600</span><br><span class="line">  zone: <span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>修改后按 ESC 输入 <code>:wq</code> 保存退出，接着使用 KubeKey 开始安装。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br></pre></td><td class="code"><pre><span class="line">&gt; egrep -v <span class="string">&#x27;#|^$&#x27;</span> config-init.yaml</span><br><span class="line">&gt; ./kk create cluster -f config-init.yaml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> _   __      _          _   __</span><br><span class="line">| | / /     | |        | | / /</span><br><span class="line">| |/ / _   _| |__   ___| |/ /  ___ _   _</span><br><span class="line">|    \| | | | <span class="string">&#x27;_ \ / _ \    \ / _ \ | | |</span></span><br><span class="line"><span class="string">| |\  \ |_| | |_) |  __/ |\  \  __/ |_| |</span></span><br><span class="line"><span class="string">\_| \_/\__,_|_.__/ \___\_| \_/\___|\__, |</span></span><br><span class="line"><span class="string">                                    __/ |</span></span><br><span class="line"><span class="string">                                   |___/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">13:39:30 CST [GreetingsModule] Greetings</span></span><br><span class="line"><span class="string">13:39:30 CST message: [k3s-master]</span></span><br><span class="line"><span class="string">Greetings, KubeKey!</span></span><br><span class="line"><span class="string">13:39:30 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:39:30 CST [NodePreCheckModule] A pre-check on nodes</span></span><br><span class="line"><span class="string">13:39:30 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:39:30 CST [ConfirmModule] Display confirmation form</span></span><br><span class="line"><span class="string">+------------+------+------+---------+----------+-------+-------+---------+-----------+--------+--------+------------+------------+-------------+------------------+--------------+</span></span><br><span class="line"><span class="string">| name       | sudo | curl | openssl | ebtables | socat | ipset | ipvsadm | conntrack | chrony | docker | containerd | nfs client | ceph client | glusterfs client | time         |</span></span><br><span class="line"><span class="string">+------------+------+------+---------+----------+-------+-------+---------+-----------+--------+--------+------------+------------+-------------+------------------+--------------+</span></span><br><span class="line"><span class="string">| k3s-master | y    | y    | y       | y        | y     | y     | y       | y         | y      |        | v1.7.13    | y          |             |                  | CST 13:39:30 |</span></span><br><span class="line"><span class="string">+------------+------+------+---------+----------+-------+-------+---------+-----------+--------+--------+------------+------------+-------------+------------------+--------------+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">This is a simple check of your environment.</span></span><br><span class="line"><span class="string">Before installation, ensure that your machines meet all requirements specified at</span></span><br><span class="line"><span class="string">https://github.com/kubesphere/kubekey#requirements-and-recommendations</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Install k8s with specify version:  v1.24.17</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Continue this installation? [yes/no]: yes</span></span><br><span class="line"><span class="string">13:39:37 CST success: [LocalHost]</span></span><br><span class="line"><span class="string">13:39:37 CST [NodeBinariesModule] Download installation binaries</span></span><br><span class="line"><span class="string">13:39:37 CST message: [localhost]</span></span><br><span class="line"><span class="string">downloading amd64 kubeadm v1.24.17 ...</span></span><br><span class="line"><span class="string">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span></span><br><span class="line"><span class="string">                                 Dload  Upload   Total   Spent    Left  Speed</span></span><br><span class="line"><span class="string">100 43.4M  100 43.4M    0     0   900k      0  0:00:49  0:00:49 --:--:-- 1076k</span></span><br><span class="line"><span class="string">13:40:27 CST message: [localhost]</span></span><br><span class="line"><span class="string">downloading amd64 kubelet v1.24.17 ...</span></span><br><span class="line"><span class="string">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span></span><br><span class="line"><span class="string">                                 Dload  Upload   Total   Spent    Left  Speed</span></span><br><span class="line"><span class="string">100  112M  100  112M    0     0   971k      0  0:01:58  0:01:58 --:--:-- 1063k</span></span><br><span class="line"><span class="string">13:42:26 CST message: [localhost]</span></span><br><span class="line"><span class="string">downloading amd64 kubectl v1.24.17 ...</span></span><br><span class="line"><span class="string">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span></span><br><span class="line"><span class="string">                                 Dload  Upload   Total   Spent    Left  Speed</span></span><br><span class="line"><span class="string">100 44.5M  100 44.5M    0     0   907k      0  0:00:50  0:00:50 --:--:-- 1083k</span></span><br><span class="line"><span class="string">13:43:16 CST message: [localhost]</span></span><br><span class="line"><span class="string">downloading amd64 helm v3.14.3 ...</span></span><br><span class="line"><span class="string">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span></span><br><span class="line"><span class="string">                                 Dload  Upload   Total   Spent    Left  Speed</span></span><br><span class="line"><span class="string">100 48.3M  100 48.3M    0     0   914k      0  0:00:54  0:00:54 --:--:-- 1076k</span></span><br><span class="line"><span class="string">13:44:11 CST message: [localhost]</span></span><br><span class="line"><span class="string">downloading amd64 kubecni v1.2.0 ...</span></span><br><span class="line"><span class="string">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span></span><br><span class="line"><span class="string">                                 Dload  Upload   Total   Spent    Left  Speed</span></span><br><span class="line"><span class="string">100 38.6M  100 38.6M    0     0   900k      0  0:00:43  0:00:43 --:--:-- 1173k</span></span><br><span class="line"><span class="string">13:44:55 CST message: [localhost]</span></span><br><span class="line"><span class="string">downloading amd64 crictl v1.29.0 ...</span></span><br><span class="line"><span class="string">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span></span><br><span class="line"><span class="string">                                 Dload  Upload   Total   Spent    Left  Speed</span></span><br><span class="line"><span class="string">100 23.2M  100 23.2M    0     0   819k      0  0:00:29  0:00:29 --:--:-- 1080k</span></span><br><span class="line"><span class="string">13:45:24 CST message: [localhost]</span></span><br><span class="line"><span class="string">downloading amd64 etcd v3.5.13 ...</span></span><br><span class="line"><span class="string">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span></span><br><span class="line"><span class="string">                                 Dload  Upload   Total   Spent    Left  Speed</span></span><br><span class="line"><span class="string">100 19.1M  100 19.1M    0     0   778k      0  0:00:25  0:00:25 --:--:-- 1036k</span></span><br><span class="line"><span class="string">13:45:49 CST message: [localhost]</span></span><br><span class="line"><span class="string">downloading amd64 containerd 1.7.13 ...</span></span><br><span class="line"><span class="string">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span></span><br><span class="line"><span class="string">                                 Dload  Upload   Total   Spent    Left  Speed</span></span><br><span class="line"><span class="string">100 45.7M  100 45.7M    0     0   908k      0  0:00:51  0:00:51 --:--:-- 1079k</span></span><br><span class="line"><span class="string">13:46:41 CST message: [localhost]</span></span><br><span class="line"><span class="string">downloading amd64 runc v1.1.12 ...</span></span><br><span class="line"><span class="string">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span></span><br><span class="line"><span class="string">                                 Dload  Upload   Total   Spent    Left  Speed</span></span><br><span class="line"><span class="string">100 10.2M  100 10.2M    0     0   658k      0  0:00:15  0:00:15 --:--:-- 1079k</span></span><br><span class="line"><span class="string">13:46:57 CST message: [localhost]</span></span><br><span class="line"><span class="string">downloading amd64 calicoctl v3.27.4 ...</span></span><br><span class="line"><span class="string">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span></span><br><span class="line"><span class="string">                                 Dload  Upload   Total   Spent    Left  Speed</span></span><br><span class="line"><span class="string">100 61.3M  100 61.3M    0     0   939k      0  0:01:06  0:01:06 --:--:-- 1101k</span></span><br><span class="line"><span class="string">13:48:04 CST success: [LocalHost]</span></span><br><span class="line"><span class="string">13:48:04 CST [ConfigureOSModule] Get OS release</span></span><br><span class="line"><span class="string">13:48:04 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:04 CST [ConfigureOSModule] Prepare to init OS</span></span><br><span class="line"><span class="string">13:48:05 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:05 CST [ConfigureOSModule] Generate init os script</span></span><br><span class="line"><span class="string">13:48:05 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:05 CST [ConfigureOSModule] Exec init os script</span></span><br><span class="line"><span class="string">13:48:07 CST stdout: [k3s-master]</span></span><br><span class="line"><span class="string">setenforce: SELinux is disabled</span></span><br><span class="line"><span class="string">Disabled</span></span><br><span class="line"><span class="string">net.ipv4.tcp_syncookies = 1</span></span><br><span class="line"><span class="string">net.ipv4.conf.all.accept_source_route = 0</span></span><br><span class="line"><span class="string">net.ipv4.conf.all.accept_redirects = 0</span></span><br><span class="line"><span class="string">net.ipv4.conf.all.rp_filter = 0</span></span><br><span class="line"><span class="string">net.ipv4.icmp_echo_ignore_broadcasts = 1</span></span><br><span class="line"><span class="string">net.ipv4.icmp_ignore_bogus_error_responses = 1</span></span><br><span class="line"><span class="string">kernel.sched_child_runs_first = 1</span></span><br><span class="line"><span class="string">kernel.sched_latency_ns = 80000000</span></span><br><span class="line"><span class="string">kernel.sched_migration_cost_ns = 125000</span></span><br><span class="line"><span class="string">kernel.sched_min_granularity_ns = 40000000</span></span><br><span class="line"><span class="string">kernel.sched_wakeup_granularity_ns = 3750000</span></span><br><span class="line"><span class="string">kernel.sched_nr_migrate = 128</span></span><br><span class="line"><span class="string">kernel.pid_max = 65535</span></span><br><span class="line"><span class="string">kernel.msgmax = 2097152</span></span><br><span class="line"><span class="string">kernel.msgmnb = 4194304</span></span><br><span class="line"><span class="string">kernel.shmmni = 32768</span></span><br><span class="line"><span class="string">kernel.sem = 2000 256000 256 1024</span></span><br><span class="line"><span class="string">vm.overcommit_memory = 0</span></span><br><span class="line"><span class="string">vm.max_map_count = 262144</span></span><br><span class="line"><span class="string">vm.swappiness = 0</span></span><br><span class="line"><span class="string">vm.dirty_background_ratio = 40</span></span><br><span class="line"><span class="string">vm.dirty_ratio = 50</span></span><br><span class="line"><span class="string">fs.aio-max-nr = 262144</span></span><br><span class="line"><span class="string">fs.inotify.max_user_instances = 524288</span></span><br><span class="line"><span class="string">fs.inotify.max_user_watches = 524288</span></span><br><span class="line"><span class="string">net.core.rps_sock_flow_entries = 65536</span></span><br><span class="line"><span class="string">net.core.dev_weight = 1024</span></span><br><span class="line"><span class="string">net.core.busy_poll = 200</span></span><br><span class="line"><span class="string">net.core.busy_read = 200</span></span><br><span class="line"><span class="string">net.ipv4.tcp_moderate_rcvbuf = 1</span></span><br><span class="line"><span class="string">net.core.somaxconn = 32768</span></span><br><span class="line"><span class="string">net.core.netdev_max_backlog = 65535</span></span><br><span class="line"><span class="string">net.core.netdev_budget = 4800</span></span><br><span class="line"><span class="string">net.ipv4.neigh.default.gc_thresh1 = 512</span></span><br><span class="line"><span class="string">net.ipv4.neigh.default.gc_thresh2 = 2048</span></span><br><span class="line"><span class="string">net.ipv4.neigh.default.gc_thresh3 = 4096</span></span><br><span class="line"><span class="string">net.ipv4.neigh.default.unres_qlen_bytes = 262144</span></span><br><span class="line"><span class="string">net.netfilter.nf_conntrack_max = 1048576</span></span><br><span class="line"><span class="string">net.netfilter.nf_conntrack_tcp_timeout_established = 300</span></span><br><span class="line"><span class="string">sysctl: setting key &quot;net.netfilter.nf_conntrack_buckets&quot;: No such file or directory</span></span><br><span class="line"><span class="string">net.ipv4.ipfrag_high_thresh = 16777216</span></span><br><span class="line"><span class="string">net.ipv4.ipfrag_low_thresh = 12582912</span></span><br><span class="line"><span class="string">net.ipv4.tcp_rmem = 8388608 16777216 67108864</span></span><br><span class="line"><span class="string">net.ipv4.tcp_wmem = 8388608 16777216 67108864</span></span><br><span class="line"><span class="string">net.ipv4.udp_rmem_min = 131072</span></span><br><span class="line"><span class="string">net.ipv4.udp_wmem_min = 131072</span></span><br><span class="line"><span class="string">net.core.rmem_default = 33554432</span></span><br><span class="line"><span class="string">net.core.wmem_default = 33554432</span></span><br><span class="line"><span class="string">net.core.rmem_max = 33554432</span></span><br><span class="line"><span class="string">net.core.wmem_max = 33554432</span></span><br><span class="line"><span class="string">net.ipv4.tcp_fin_timeout = 5</span></span><br><span class="line"><span class="string">net.ipv4.tcp_keepalive_time = 600</span></span><br><span class="line"><span class="string">net.ipv4.ip_local_port_range = 10000 65000</span></span><br><span class="line"><span class="string">net.ipv4.tcp_max_syn_backlog = 1048576</span></span><br><span class="line"><span class="string">net.ipv4.tcp_max_tw_buckets = 1048576</span></span><br><span class="line"><span class="string">net.ipv4.ip_forward = 1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-arptables = 1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-ip6tables = 1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables = 1</span></span><br><span class="line"><span class="string">net.ipv4.ip_local_reserved_ports = 30000-32767</span></span><br><span class="line"><span class="string">net.ipv4.tcp_retries2 = 15</span></span><br><span class="line"><span class="string">net.ipv4.tcp_max_orphans = 65535</span></span><br><span class="line"><span class="string">net.ipv4.tcp_keepalive_intvl = 30</span></span><br><span class="line"><span class="string">net.ipv4.tcp_keepalive_probes = 10</span></span><br><span class="line"><span class="string">net.ipv4.conf.default.rp_filter = 0</span></span><br><span class="line"><span class="string">net.ipv4.conf.all.arp_accept = 1</span></span><br><span class="line"><span class="string">net.ipv4.conf.default.arp_accept = 1</span></span><br><span class="line"><span class="string">net.ipv4.conf.all.arp_ignore = 1</span></span><br><span class="line"><span class="string">net.ipv4.conf.default.arp_ignore = 1</span></span><br><span class="line"><span class="string">fs.pipe-max-size = 4194304</span></span><br><span class="line"><span class="string">kernel.watchdog_thresh = 5</span></span><br><span class="line"><span class="string">kernel.hung_task_timeout_secs = 5</span></span><br><span class="line"><span class="string">net.ipv6.conf.all.disable_ipv6 = 0</span></span><br><span class="line"><span class="string">net.ipv6.conf.default.disable_ipv6 = 0</span></span><br><span class="line"><span class="string">net.ipv6.conf.lo.disable_ipv6 = 0</span></span><br><span class="line"><span class="string">net.ipv6.conf.all.forwarding = 1</span></span><br><span class="line"><span class="string">13:48:07 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:07 CST [ConfigureOSModule] configure the ntp server for each node</span></span><br><span class="line"><span class="string">13:48:07 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:07 CST [KubernetesStatusModule] Get kubernetes cluster status</span></span><br><span class="line"><span class="string">13:48:08 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:08 CST [InstallContainerModule] Sync containerd binaries</span></span><br><span class="line"><span class="string">13:48:08 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:08 CST [InstallContainerModule] Generate containerd service</span></span><br><span class="line"><span class="string">13:48:08 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:08 CST [InstallContainerModule] Generate containerd config</span></span><br><span class="line"><span class="string">13:48:08 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:08 CST [InstallContainerModule] Enable containerd</span></span><br><span class="line"><span class="string">13:48:08 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:08 CST [InstallContainerModule] Sync crictl binaries</span></span><br><span class="line"><span class="string">13:48:08 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:08 CST [InstallContainerModule] Generate crictl config</span></span><br><span class="line"><span class="string">13:48:08 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:08 CST [PullModule] Start to pull images on all nodes</span></span><br><span class="line"><span class="string">13:48:08 CST message: [k3s-master]</span></span><br><span class="line"><span class="string">downloading image: registry.cn-beijing.aliyuncs.com/kubesphereio/pause:3.7</span></span><br><span class="line"><span class="string">13:48:08 CST message: [k3s-master]</span></span><br><span class="line"><span class="string">downloading image: registry.cn-beijing.aliyuncs.com/kubesphereio/kube-apiserver:v1.24.17</span></span><br><span class="line"><span class="string">13:48:08 CST message: [k3s-master]</span></span><br><span class="line"><span class="string">downloading image: registry.cn-beijing.aliyuncs.com/kubesphereio/kube-controller-manager:v1.24.17</span></span><br><span class="line"><span class="string">13:48:08 CST message: [k3s-master]</span></span><br><span class="line"><span class="string">downloading image: registry.cn-beijing.aliyuncs.com/kubesphereio/kube-scheduler:v1.24.17</span></span><br><span class="line"><span class="string">13:48:08 CST message: [k3s-master]</span></span><br><span class="line"><span class="string">downloading image: registry.cn-beijing.aliyuncs.com/kubesphereio/kube-proxy:v1.24.17</span></span><br><span class="line"><span class="string">13:48:09 CST message: [k3s-master]</span></span><br><span class="line"><span class="string">downloading image: registry.cn-beijing.aliyuncs.com/kubesphereio/coredns:1.8.6</span></span><br><span class="line"><span class="string">13:48:09 CST message: [k3s-master]</span></span><br><span class="line"><span class="string">downloading image: registry.cn-beijing.aliyuncs.com/kubesphereio/k8s-dns-node-cache:1.22.20</span></span><br><span class="line"><span class="string">13:48:09 CST message: [k3s-master]</span></span><br><span class="line"><span class="string">downloading image: registry.cn-beijing.aliyuncs.com/kubesphereio/kube-controllers:v3.27.4</span></span><br><span class="line"><span class="string">13:48:09 CST message: [k3s-master]</span></span><br><span class="line"><span class="string">downloading image: registry.cn-beijing.aliyuncs.com/kubesphereio/cni:v3.27.4</span></span><br><span class="line"><span class="string">13:48:09 CST message: [k3s-master]</span></span><br><span class="line"><span class="string">downloading image: registry.cn-beijing.aliyuncs.com/kubesphereio/node:v3.27.4</span></span><br><span class="line"><span class="string">13:48:09 CST message: [k3s-master]</span></span><br><span class="line"><span class="string">downloading image: registry.cn-beijing.aliyuncs.com/kubesphereio/pod2daemon-flexvol:v3.27.4</span></span><br><span class="line"><span class="string">13:48:09 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:09 CST [ETCDPreCheckModule] Get etcd status</span></span><br><span class="line"><span class="string">13:48:09 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:09 CST [CertsModule] Fetch etcd certs</span></span><br><span class="line"><span class="string">13:48:09 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:09 CST [CertsModule] Generate etcd Certs</span></span><br><span class="line"><span class="string">[certs] Generating &quot;ca&quot; certificate and key</span></span><br><span class="line"><span class="string">[certs] admin-k3s-master serving cert is signed for DNS names [etcd etcd.kube-system etcd.kube-system.svc etcd.kube-system.svc.cluster.local k3s-master lb.kubesphere.local localhost] and IPs [127.0.0.1 ::1 10.2.2.109]</span></span><br><span class="line"><span class="string">[certs] member-k3s-master serving cert is signed for DNS names [etcd etcd.kube-system etcd.kube-system.svc etcd.kube-system.svc.cluster.local k3s-master lb.kubesphere.local localhost] and IPs [127.0.0.1 ::1 10.2.2.109]</span></span><br><span class="line"><span class="string">[certs] node-k3s-master serving cert is signed for DNS names [etcd etcd.kube-system etcd.kube-system.svc etcd.kube-system.svc.cluster.local k3s-master lb.kubesphere.local localhost] and IPs [127.0.0.1 ::1 10.2.2.109]</span></span><br><span class="line"><span class="string">13:48:11 CST success: [LocalHost]</span></span><br><span class="line"><span class="string">13:48:11 CST [CertsModule] Synchronize certs file</span></span><br><span class="line"><span class="string">13:48:12 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:12 CST [CertsModule] Synchronize certs file to master</span></span><br><span class="line"><span class="string">13:48:12 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:12 CST [InstallETCDBinaryModule] Install etcd using binary</span></span><br><span class="line"><span class="string">13:48:14 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:14 CST [InstallETCDBinaryModule] Generate etcd service</span></span><br><span class="line"><span class="string">13:48:14 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:14 CST [InstallETCDBinaryModule] Generate access address</span></span><br><span class="line"><span class="string">13:48:14 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:14 CST [ETCDConfigureModule] Health check on exist etcd</span></span><br><span class="line"><span class="string">13:48:14 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:14 CST [ETCDConfigureModule] Generate etcd.env config on new etcd</span></span><br><span class="line"><span class="string">13:48:14 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:14 CST [ETCDConfigureModule] Refresh etcd.env config on all etcd</span></span><br><span class="line"><span class="string">13:48:14 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:14 CST [ETCDConfigureModule] Restart etcd</span></span><br><span class="line"><span class="string">13:48:19 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:19 CST [ETCDConfigureModule] Health check on all etcd</span></span><br><span class="line"><span class="string">13:48:19 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:19 CST [ETCDConfigureModule] Refresh etcd.env config to exist mode on all etcd</span></span><br><span class="line"><span class="string">13:48:19 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:19 CST [ETCDConfigureModule] Health check on all etcd</span></span><br><span class="line"><span class="string">13:48:20 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:20 CST [ETCDBackupModule] Backup etcd data regularly</span></span><br><span class="line"><span class="string">13:48:20 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:20 CST [ETCDBackupModule] Generate backup ETCD service</span></span><br><span class="line"><span class="string">13:48:20 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:20 CST [ETCDBackupModule] Generate backup ETCD timer</span></span><br><span class="line"><span class="string">13:48:20 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:20 CST [ETCDBackupModule] Enable backup etcd service</span></span><br><span class="line"><span class="string">13:48:20 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:20 CST [InstallKubeBinariesModule] Synchronize kubernetes binaries</span></span><br><span class="line"><span class="string">13:48:27 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:27 CST [InstallKubeBinariesModule] Change kubelet mode</span></span><br><span class="line"><span class="string">13:48:27 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:27 CST [InstallKubeBinariesModule] Generate kubelet service</span></span><br><span class="line"><span class="string">13:48:27 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:27 CST [InstallKubeBinariesModule] Enable kubelet service</span></span><br><span class="line"><span class="string">13:48:28 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:28 CST [InstallKubeBinariesModule] Generate kubelet env</span></span><br><span class="line"><span class="string">13:48:28 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:28 CST [InitKubernetesModule] Generate kubeadm config</span></span><br><span class="line"><span class="string">13:48:28 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:28 CST [InitKubernetesModule] Generate audit policy</span></span><br><span class="line"><span class="string">13:48:28 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:28 CST [InitKubernetesModule] Generate audit webhook</span></span><br><span class="line"><span class="string">13:48:28 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:28 CST [InitKubernetesModule] Init cluster using kubeadm</span></span><br><span class="line"><span class="string">13:48:51 CST stdout: [k3s-master]</span></span><br><span class="line"><span class="string">W1009 13:48:28.956892   11930 utils.go:69] The recommended value for &quot;clusterDNS&quot; in &quot;KubeletConfiguration&quot; is: [10.233.0.10]; the provided value is: [169.254.25.10]</span></span><br><span class="line"><span class="string">[init] Using Kubernetes version: v1.24.17</span></span><br><span class="line"><span class="string">[preflight] Running pre-flight checks</span></span><br><span class="line"><span class="string">[preflight] Pulling images required for setting up a Kubernetes cluster</span></span><br><span class="line"><span class="string">[preflight] This might take a minute or two, depending on the speed of your internet connection</span></span><br><span class="line"><span class="string">[preflight] You can also perform this action in beforehand using &#x27;</span>kubeadm config images pull<span class="string">&#x27;</span></span><br><span class="line"><span class="string">[certs] Using certificateDir folder &quot;/etc/kubernetes/pki&quot;</span></span><br><span class="line"><span class="string">[certs] Generating &quot;ca&quot; certificate and key</span></span><br><span class="line"><span class="string">[certs] Generating &quot;apiserver&quot; certificate and key</span></span><br><span class="line"><span class="string">[certs] apiserver serving cert is signed for DNS names [k3s-master k3s-master.cluster.local kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local lb.kubesphere.local localhost] and IPs [10.233.0.1 10.2.2.109 127.0.0.1]</span></span><br><span class="line"><span class="string">[certs] Generating &quot;apiserver-kubelet-client&quot; certificate and key</span></span><br><span class="line"><span class="string">[certs] Generating &quot;front-proxy-ca&quot; certificate and key</span></span><br><span class="line"><span class="string">[certs] Generating &quot;front-proxy-client&quot; certificate and key</span></span><br><span class="line"><span class="string">[certs] External etcd mode: Skipping etcd/ca certificate authority generation</span></span><br><span class="line"><span class="string">[certs] External etcd mode: Skipping etcd/server certificate generation</span></span><br><span class="line"><span class="string">[certs] External etcd mode: Skipping etcd/peer certificate generation</span></span><br><span class="line"><span class="string">[certs] External etcd mode: Skipping etcd/healthcheck-client certificate generation</span></span><br><span class="line"><span class="string">[certs] External etcd mode: Skipping apiserver-etcd-client certificate generation</span></span><br><span class="line"><span class="string">[certs] Generating &quot;sa&quot; key and public key</span></span><br><span class="line"><span class="string">[kubeconfig] Using kubeconfig folder &quot;/etc/kubernetes&quot;</span></span><br><span class="line"><span class="string">[kubeconfig] Writing &quot;admin.conf&quot; kubeconfig file</span></span><br><span class="line"><span class="string">[kubeconfig] Writing &quot;kubelet.conf&quot; kubeconfig file</span></span><br><span class="line"><span class="string">[kubeconfig] Writing &quot;controller-manager.conf&quot; kubeconfig file</span></span><br><span class="line"><span class="string">[kubeconfig] Writing &quot;scheduler.conf&quot; kubeconfig file</span></span><br><span class="line"><span class="string">[kubelet-start] Writing kubelet environment file with flags to file &quot;/var/lib/kubelet/kubeadm-flags.env&quot;</span></span><br><span class="line"><span class="string">[kubelet-start] Writing kubelet configuration to file &quot;/var/lib/kubelet/config.yaml&quot;</span></span><br><span class="line"><span class="string">[kubelet-start] Starting the kubelet</span></span><br><span class="line"><span class="string">[control-plane] Using manifest folder &quot;/etc/kubernetes/manifests&quot;</span></span><br><span class="line"><span class="string">[control-plane] Creating static Pod manifest for &quot;kube-apiserver&quot;</span></span><br><span class="line"><span class="string">[control-plane] Creating static Pod manifest for &quot;kube-controller-manager&quot;</span></span><br><span class="line"><span class="string">[control-plane] Creating static Pod manifest for &quot;kube-scheduler&quot;</span></span><br><span class="line"><span class="string">[wait-control-plane] Waiting for the kubelet to boot up the control plane as static Pods from directory &quot;/etc/kubernetes/manifests&quot;. This can take up to 4m0s</span></span><br><span class="line"><span class="string">[apiclient] All control plane components are healthy after 17.503847 seconds</span></span><br><span class="line"><span class="string">[upload-config] Storing the configuration used in ConfigMap &quot;kubeadm-config&quot; in the &quot;kube-system&quot; Namespace</span></span><br><span class="line"><span class="string">[kubelet] Creating a ConfigMap &quot;kubelet-config&quot; in namespace kube-system with the configuration for the kubelets in the cluster</span></span><br><span class="line"><span class="string">[upload-certs] Skipping phase. Please see --upload-certs</span></span><br><span class="line"><span class="string">[mark-control-plane] Marking the node k3s-master as control-plane by adding the labels: [node-role.kubernetes.io/control-plane node.kubernetes.io/exclude-from-external-load-balancers]</span></span><br><span class="line"><span class="string">[mark-control-plane] Marking the node k3s-master as control-plane by adding the taints [node-role.kubernetes.io/master:NoSchedule node-role.kubernetes.io/control-plane:NoSchedule]</span></span><br><span class="line"><span class="string">[bootstrap-token] Using token: kvwh7d.tiuyjnwfbc8bqyt7</span></span><br><span class="line"><span class="string">[bootstrap-token] Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles</span></span><br><span class="line"><span class="string">[bootstrap-token] Configured RBAC rules to allow Node Bootstrap tokens to get nodes</span></span><br><span class="line"><span class="string">[bootstrap-token] Configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials</span></span><br><span class="line"><span class="string">[bootstrap-token] Configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token</span></span><br><span class="line"><span class="string">[bootstrap-token] Configured RBAC rules to allow certificate rotation for all node client certificates in the cluster</span></span><br><span class="line"><span class="string">[bootstrap-token] Creating the &quot;cluster-info&quot; ConfigMap in the &quot;kube-public&quot; namespace</span></span><br><span class="line"><span class="string">[kubelet-finalize] Updating &quot;/etc/kubernetes/kubelet.conf&quot; to point to a rotatable kubelet client certificate and key</span></span><br><span class="line"><span class="string">[addons] Applied essential addon: CoreDNS</span></span><br><span class="line"><span class="string">[addons] Applied essential addon: kube-proxy</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Your Kubernetes control-plane has initialized successfully!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">To start using your cluster, you need to run the following as a regular user:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  mkdir -p $HOME/.kube</span></span><br><span class="line"><span class="string">  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span></span><br><span class="line"><span class="string">  sudo chown $(id -u):$(id -g) $HOME/.kube/config</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Alternatively, if you are the root user, you can run:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  export KUBECONFIG=/etc/kubernetes/admin.conf</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">You should now deploy a pod network to the cluster.</span></span><br><span class="line"><span class="string">Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:</span></span><br><span class="line"><span class="string">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">You can now join any number of control-plane nodes by copying certificate authorities</span></span><br><span class="line"><span class="string">and service account keys on each node and then running the following as root:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  kubeadm join lb.kubesphere.local:6443 --token kvwh7d.tiuyjnwfbc8bqyt7 \</span></span><br><span class="line"><span class="string">        --discovery-token-ca-cert-hash sha256:1f5b22071a80e7c647e441c29d0569b391de0dd15d2065c4283ee4c744a1327c \</span></span><br><span class="line"><span class="string">        --control-plane</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Then you can join any number of worker nodes by running the following on each as root:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">kubeadm join lb.kubesphere.local:6443 --token kvwh7d.tiuyjnwfbc8bqyt7 \</span></span><br><span class="line"><span class="string">        --discovery-token-ca-cert-hash sha256:1f5b22071a80e7c647e441c29d0569b391de0dd15d2065c4283ee4c744a1327c</span></span><br><span class="line"><span class="string">13:48:51 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:51 CST [InitKubernetesModule] Copy admin.conf to ~/.kube/config</span></span><br><span class="line"><span class="string">13:48:51 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:51 CST [InitKubernetesModule] Remove master taint</span></span><br><span class="line"><span class="string">13:48:53 CST stdout: [k3s-master]</span></span><br><span class="line"><span class="string">node/k3s-master untainted</span></span><br><span class="line"><span class="string">13:48:53 CST stdout: [k3s-master]</span></span><br><span class="line"><span class="string">node/k3s-master untainted</span></span><br><span class="line"><span class="string">13:48:53 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:53 CST [ClusterDNSModule] Generate coredns configmap</span></span><br><span class="line"><span class="string">13:48:53 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:53 CST [ClusterDNSModule] Apply coredns configmap</span></span><br><span class="line"><span class="string">13:48:54 CST stdout: [k3s-master]</span></span><br><span class="line"><span class="string">Warning: resource configmaps/coredns is missing the kubectl.kubernetes.io/last-applied-configuration annotation which is required by kubectl apply. kubectl apply should only be used on resources created declaratively by either kubectl create --save-config or kubectl apply. The missing annotation will be patched automatically.</span></span><br><span class="line"><span class="string">configmap/coredns configured</span></span><br><span class="line"><span class="string">13:48:54 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:54 CST [ClusterDNSModule] Generate coredns manifests</span></span><br><span class="line"><span class="string">13:48:54 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:54 CST [ClusterDNSModule] Deploy coredns</span></span><br><span class="line"><span class="string">13:48:54 CST stdout: [k3s-master]</span></span><br><span class="line"><span class="string">service &quot;kube-dns&quot; deleted</span></span><br><span class="line"><span class="string">13:48:55 CST stdout: [k3s-master]</span></span><br><span class="line"><span class="string">Warning: resource clusterroles/system:coredns is missing the kubectl.kubernetes.io/last-applied-configuration annotation which is required by kubectl apply. kubectl apply should only be used on resources created declaratively by either kubectl create --save-config or kubectl apply. The missing annotation will be patched automatically.</span></span><br><span class="line"><span class="string">clusterrole.rbac.authorization.k8s.io/system:coredns configured</span></span><br><span class="line"><span class="string">service/coredns created</span></span><br><span class="line"><span class="string">Warning: resource deployments/coredns is missing the kubectl.kubernetes.io/last-applied-configuration annotation which is required by kubectl apply. kubectl apply should only be used on resources created declaratively by either kubectl create --save-config or kubectl apply. The missing annotation will be patched automatically.</span></span><br><span class="line"><span class="string">deployment.apps/coredns configured</span></span><br><span class="line"><span class="string">13:48:55 CST stdout: [k3s-master]</span></span><br><span class="line"><span class="string">deployment.apps/coredns restarted</span></span><br><span class="line"><span class="string">13:48:55 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:55 CST [ClusterDNSModule] Generate nodelocaldns configmap</span></span><br><span class="line"><span class="string">13:48:55 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:55 CST [ClusterDNSModule] Apply nodelocaldns configmap</span></span><br><span class="line"><span class="string">13:48:56 CST stdout: [k3s-master]</span></span><br><span class="line"><span class="string">configmap/nodelocaldns created</span></span><br><span class="line"><span class="string">13:48:56 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:56 CST [ClusterDNSModule] Generate nodelocaldns</span></span><br><span class="line"><span class="string">13:48:56 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:56 CST [ClusterDNSModule] Deploy nodelocaldns</span></span><br><span class="line"><span class="string">13:48:56 CST stdout: [k3s-master]</span></span><br><span class="line"><span class="string">serviceaccount/nodelocaldns created</span></span><br><span class="line"><span class="string">daemonset.apps/nodelocaldns created</span></span><br><span class="line"><span class="string">13:48:56 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:56 CST [KubernetesStatusModule] Get kubernetes cluster status</span></span><br><span class="line"><span class="string">13:48:56 CST stdout: [k3s-master]</span></span><br><span class="line"><span class="string">v1.24.17</span></span><br><span class="line"><span class="string">13:48:56 CST stdout: [k3s-master]</span></span><br><span class="line"><span class="string">k3s-master   v1.24.17   [map[address:10.2.2.109 type:InternalIP] map[address:k3s-master type:Hostname]]</span></span><br><span class="line"><span class="string">13:48:57 CST stdout: [k3s-master]</span></span><br><span class="line"><span class="string">W1009 13:48:57.018811   13416 utils.go:69] The recommended value for &quot;clusterDNS&quot; in &quot;KubeletConfiguration&quot; is: [10.233.0.10]; the provided value is: [169.254.25.10]</span></span><br><span class="line"><span class="string">[upload-certs] Storing the certificates in Secret &quot;kubeadm-certs&quot; in the &quot;kube-system&quot; Namespace</span></span><br><span class="line"><span class="string">[upload-certs] Using certificate key:</span></span><br><span class="line"><span class="string">64625b6043ef538848338b08d634ec2fdb933288b8b816ce928214b0398da1fa</span></span><br><span class="line"><span class="string">13:48:57 CST stdout: [k3s-master]</span></span><br><span class="line"><span class="string">secret/kubeadm-certs patched</span></span><br><span class="line"><span class="string">13:48:57 CST stdout: [k3s-master]</span></span><br><span class="line"><span class="string">secret/kubeadm-certs patched</span></span><br><span class="line"><span class="string">13:48:57 CST stdout: [k3s-master]</span></span><br><span class="line"><span class="string">secret/kubeadm-certs patched</span></span><br><span class="line"><span class="string">13:48:57 CST stdout: [k3s-master]</span></span><br><span class="line"><span class="string">gda258.973k95vadvzwx5y1</span></span><br><span class="line"><span class="string">13:48:57 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:57 CST [JoinNodesModule] Generate kubeadm config</span></span><br><span class="line"><span class="string">13:48:57 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:57 CST [JoinNodesModule] Generate audit policy</span></span><br><span class="line"><span class="string">13:48:57 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:57 CST [JoinNodesModule] Generate audit webhook</span></span><br><span class="line"><span class="string">13:48:57 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:57 CST [JoinNodesModule] Join control-plane node</span></span><br><span class="line"><span class="string">13:48:57 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:57 CST [JoinNodesModule] Join worker node</span></span><br><span class="line"><span class="string">13:48:57 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:57 CST [JoinNodesModule] Copy admin.conf to ~/.kube/config</span></span><br><span class="line"><span class="string">13:48:57 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:57 CST [JoinNodesModule] Remove master taint</span></span><br><span class="line"><span class="string">13:48:57 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:57 CST [JoinNodesModule] Add worker label to all nodes</span></span><br><span class="line"><span class="string">13:48:57 CST stdout: [k3s-master]</span></span><br><span class="line"><span class="string">node/k3s-master labeled</span></span><br><span class="line"><span class="string">13:48:57 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:57 CST [DeployNetworkPluginModule] Generate calico</span></span><br><span class="line"><span class="string">13:48:58 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:48:58 CST [DeployNetworkPluginModule] Deploy calico</span></span><br><span class="line"><span class="string">13:49:00 CST stdout: [k3s-master]</span></span><br><span class="line"><span class="string">poddisruptionbudget.policy/calico-kube-controllers created</span></span><br><span class="line"><span class="string">serviceaccount/calico-kube-controllers created</span></span><br><span class="line"><span class="string">serviceaccount/calico-node created</span></span><br><span class="line"><span class="string">serviceaccount/calico-cni-plugin created</span></span><br><span class="line"><span class="string">configmap/calico-config created</span></span><br><span class="line"><span class="string">customresourcedefinition.apiextensions.k8s.io/bgpconfigurations.crd.projectcalico.org created</span></span><br><span class="line"><span class="string">customresourcedefinition.apiextensions.k8s.io/bgpfilters.crd.projectcalico.org created</span></span><br><span class="line"><span class="string">customresourcedefinition.apiextensions.k8s.io/bgppeers.crd.projectcalico.org created</span></span><br><span class="line"><span class="string">customresourcedefinition.apiextensions.k8s.io/blockaffinities.crd.projectcalico.org created</span></span><br><span class="line"><span class="string">customresourcedefinition.apiextensions.k8s.io/caliconodestatuses.crd.projectcalico.org created</span></span><br><span class="line"><span class="string">customresourcedefinition.apiextensions.k8s.io/clusterinformations.crd.projectcalico.org created</span></span><br><span class="line"><span class="string">customresourcedefinition.apiextensions.k8s.io/felixconfigurations.crd.projectcalico.org created</span></span><br><span class="line"><span class="string">customresourcedefinition.apiextensions.k8s.io/globalnetworkpolicies.crd.projectcalico.org created</span></span><br><span class="line"><span class="string">customresourcedefinition.apiextensions.k8s.io/globalnetworksets.crd.projectcalico.org created</span></span><br><span class="line"><span class="string">customresourcedefinition.apiextensions.k8s.io/hostendpoints.crd.projectcalico.org created</span></span><br><span class="line"><span class="string">customresourcedefinition.apiextensions.k8s.io/ipamblocks.crd.projectcalico.org created</span></span><br><span class="line"><span class="string">customresourcedefinition.apiextensions.k8s.io/ipamconfigs.crd.projectcalico.org created</span></span><br><span class="line"><span class="string">customresourcedefinition.apiextensions.k8s.io/ipamhandles.crd.projectcalico.org created</span></span><br><span class="line"><span class="string">customresourcedefinition.apiextensions.k8s.io/ippools.crd.projectcalico.org created</span></span><br><span class="line"><span class="string">customresourcedefinition.apiextensions.k8s.io/ipreservations.crd.projectcalico.org created</span></span><br><span class="line"><span class="string">customresourcedefinition.apiextensions.k8s.io/kubecontrollersconfigurations.crd.projectcalico.org created</span></span><br><span class="line"><span class="string">customresourcedefinition.apiextensions.k8s.io/networkpolicies.crd.projectcalico.org created</span></span><br><span class="line"><span class="string">customresourcedefinition.apiextensions.k8s.io/networksets.crd.projectcalico.org created</span></span><br><span class="line"><span class="string">clusterrole.rbac.authorization.k8s.io/calico-kube-controllers created</span></span><br><span class="line"><span class="string">clusterrole.rbac.authorization.k8s.io/calico-node created</span></span><br><span class="line"><span class="string">clusterrole.rbac.authorization.k8s.io/calico-cni-plugin created</span></span><br><span class="line"><span class="string">clusterrolebinding.rbac.authorization.k8s.io/calico-kube-controllers created</span></span><br><span class="line"><span class="string">clusterrolebinding.rbac.authorization.k8s.io/calico-node created</span></span><br><span class="line"><span class="string">clusterrolebinding.rbac.authorization.k8s.io/calico-cni-plugin created</span></span><br><span class="line"><span class="string">daemonset.apps/calico-node created</span></span><br><span class="line"><span class="string">deployment.apps/calico-kube-controllers created</span></span><br><span class="line"><span class="string">13:49:00 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:49:00 CST [ConfigureKubernetesModule] Configure kubernetes</span></span><br><span class="line"><span class="string">13:49:00 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:49:00 CST [ChownModule] Chown user $HOME/.kube dir</span></span><br><span class="line"><span class="string">13:49:00 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:49:00 CST [AutoRenewCertsModule] Generate k8s certs renew script</span></span><br><span class="line"><span class="string">13:49:00 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:49:00 CST [AutoRenewCertsModule] Generate k8s certs renew service</span></span><br><span class="line"><span class="string">13:49:00 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:49:00 CST [AutoRenewCertsModule] Generate k8s certs renew timer</span></span><br><span class="line"><span class="string">13:49:00 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:49:00 CST [AutoRenewCertsModule] Enable k8s certs renew service</span></span><br><span class="line"><span class="string">13:49:01 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:49:01 CST [SaveKubeConfigModule] Save kube config as a configmap</span></span><br><span class="line"><span class="string">13:49:01 CST success: [LocalHost]</span></span><br><span class="line"><span class="string">13:49:01 CST [AddonsModule] Install addons</span></span><br><span class="line"><span class="string">13:49:01 CST message: [LocalHost]</span></span><br><span class="line"><span class="string">[0/0] enabled addons</span></span><br><span class="line"><span class="string">13:49:01 CST success: [LocalHost]</span></span><br><span class="line"><span class="string">13:49:01 CST [DeployStorageClassModule] Generate OpenEBS manifest</span></span><br><span class="line"><span class="string">13:49:01 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:49:01 CST [DeployStorageClassModule] Deploy OpenEBS as cluster default StorageClass</span></span><br><span class="line"><span class="string">13:49:02 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:49:02 CST [DeployKubeSphereModule] Generate KubeSphere ks-installer crd manifests</span></span><br><span class="line"><span class="string">13:49:02 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:49:02 CST [DeployKubeSphereModule] Apply ks-installer</span></span><br><span class="line"><span class="string">13:49:03 CST stdout: [k3s-master]</span></span><br><span class="line"><span class="string">namespace/kubesphere-system created</span></span><br><span class="line"><span class="string">serviceaccount/ks-installer created</span></span><br><span class="line"><span class="string">customresourcedefinition.apiextensions.k8s.io/clusterconfigurations.installer.kubesphere.io created</span></span><br><span class="line"><span class="string">clusterrole.rbac.authorization.k8s.io/ks-installer created</span></span><br><span class="line"><span class="string">clusterrolebinding.rbac.authorization.k8s.io/ks-installer created</span></span><br><span class="line"><span class="string">deployment.apps/ks-installer created</span></span><br><span class="line"><span class="string">13:49:03 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:49:03 CST [DeployKubeSphereModule] Add config to ks-installer manifests</span></span><br><span class="line"><span class="string">13:49:03 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:49:03 CST [DeployKubeSphereModule] Create the kubesphere namespace</span></span><br><span class="line"><span class="string">13:49:03 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:49:03 CST [DeployKubeSphereModule] Setup ks-installer config</span></span><br><span class="line"><span class="string">13:49:03 CST stdout: [k3s-master]</span></span><br><span class="line"><span class="string">secret/kube-etcd-client-certs created</span></span><br><span class="line"><span class="string">13:49:03 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">13:49:03 CST [DeployKubeSphereModule] Apply ks-installer</span></span><br><span class="line"><span class="string">13:49:06 CST stdout: [k3s-master]</span></span><br><span class="line"><span class="string">namespace/kubesphere-system unchanged</span></span><br><span class="line"><span class="string">serviceaccount/ks-installer unchanged</span></span><br><span class="line"><span class="string">customresourcedefinition.apiextensions.k8s.io/clusterconfigurations.installer.kubesphere.io unchanged</span></span><br><span class="line"><span class="string">clusterrole.rbac.authorization.k8s.io/ks-installer unchanged</span></span><br><span class="line"><span class="string">clusterrolebinding.rbac.authorization.k8s.io/ks-installer unchanged</span></span><br><span class="line"><span class="string">deployment.apps/ks-installer unchanged</span></span><br><span class="line"><span class="string">clusterconfiguration.installer.kubesphere.io/ks-installer created</span></span><br><span class="line"><span class="string">13:49:06 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">#####################################################</span></span><br><span class="line"><span class="string">###              Welcome to KubeSphere!           ###</span></span><br><span class="line"><span class="string">#####################################################</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Console: http://10.2.2.109:30880</span></span><br><span class="line"><span class="string">Account: admin</span></span><br><span class="line"><span class="string">Password: P@88w0rd</span></span><br><span class="line"><span class="string">NOTES：</span></span><br><span class="line"><span class="string">  1. After you log into the console, please check the</span></span><br><span class="line"><span class="string">     monitoring status of service components in</span></span><br><span class="line"><span class="string">     &quot;Cluster Management&quot;. If any service is not</span></span><br><span class="line"><span class="string">     ready, please wait patiently until all components</span></span><br><span class="line"><span class="string">     are up and running.</span></span><br><span class="line"><span class="string">  2. Please change the default password after login.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#####################################################</span></span><br><span class="line"><span class="string">https://kubesphere.io             2024-10-09 14:08:38</span></span><br><span class="line"><span class="string">#####################################################</span></span><br><span class="line"><span class="string">14:08:40 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">14:08:40 CST Pipeline[CreateClusterPipeline] execute successfully</span></span><br><span class="line"><span class="string">Installation is complete.</span></span><br></pre></td></tr></table></figure>

<p>安装完成，通过以下命令检查安装是否正常。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; kubectl logs -n kubesphere-system $(kubectl get pod -n kubesphere-system -l <span class="string">&#x27;app in (ks-install, ks-installer)&#x27;</span> -o jsonpath=<span class="string">&#x27;&#123;.items[0].metadata.name&#125;&#x27;</span>) -f</span><br><span class="line">&gt; <span class="built_in">export</span> KUBECONFIG=/etc/kubernetes/admin.conf</span><br><span class="line">&gt; kubectl get event -A -w</span><br><span class="line">&gt; kubectl get pod -A -w</span><br><span class="line">&gt; kubectl get sc</span><br></pre></td></tr></table></figure>

<p>访问 KubeSphere 控制台，界面如下。</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/shiyindaxiaojie/images/kubesphere/kubesphere-install-master.png" loading='lazy'></p>
<h2 id="Worker-节点"><a href="#Worker-节点" class="headerlink" title="Worker 节点"></a>Worker 节点</h2><p>在服务器节点 10.2.2.140 和 10.2.2.211 执行。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">export</span> KKZONE=cn</span><br><span class="line">&gt; rsync -aAvz -e <span class="string">&#x27;ssh -p 22&#x27;</span> 10.2.2.109:/root/k3s /root/</span><br><span class="line">&gt; <span class="built_in">cd</span> k3s</span><br><span class="line">&gt; vim config-init.yaml</span><br><span class="line"><span class="comment"># 修改关键内容</span></span><br><span class="line">spec:</span><br><span class="line">  hosts:</span><br><span class="line">  - &#123;name: k3s-master, address: 10.2.2.109, internalAddress: 10.2.2.109, user: root, password: <span class="string">&quot;k3s-master@123&quot;</span>&#125;</span><br><span class="line">  - &#123;name: k3s-worker-01, address: 10.2.2.140, internalAddress: 10.2.2.140, user: root, password: <span class="string">&quot;k3s-worker01@123&quot;</span>&#125;</span><br><span class="line">  - &#123;name: k3s-worker-02, address: 10.2.2.211, internalAddress: 10.2.2.211, user: root, password: <span class="string">&quot;k3s-worker02@123&quot;</span>&#125;</span><br><span class="line">  roleGroups:</span><br><span class="line">    etcd:</span><br><span class="line">    - k3s-master</span><br><span class="line">    control-plane:</span><br><span class="line">    - k3s-master</span><br><span class="line">    worker:</span><br><span class="line">    - k3s-master</span><br><span class="line">    - k3s-worker-01</span><br><span class="line">    - k3s-worker-02</span><br></pre></td></tr></table></figure>

<p>使用 KubeKey 安装。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br></pre></td><td class="code"><pre><span class="line">&gt; ./kk add nodes -f config-init.yaml</span><br><span class="line"></span><br><span class="line">_   __      _          _   __</span><br><span class="line">| | / /     | |        | | / /</span><br><span class="line">| |/ / _   _| |__   ___| |/ /  ___ _   _</span><br><span class="line">|    \| | | | <span class="string">&#x27;_ \ / _ \    \ / _ \ | | |</span></span><br><span class="line"><span class="string">| |\  \ |_| | |_) |  __/ |\  \  __/ |_| |</span></span><br><span class="line"><span class="string">\_| \_/\__,_|_.__/ \___\_| \_/\___|\__, |</span></span><br><span class="line"><span class="string">                                    __/ |</span></span><br><span class="line"><span class="string">                                   |___/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">15:26:05 CST [GreetingsModule] Greetings</span></span><br><span class="line"><span class="string">15:26:05 CST message: [k3s-worker-02]</span></span><br><span class="line"><span class="string">Greetings, KubeKey!</span></span><br><span class="line"><span class="string">15:26:06 CST message: [k3s-master]</span></span><br><span class="line"><span class="string">Greetings, KubeKey!</span></span><br><span class="line"><span class="string">15:26:06 CST message: [k3s-worker-01]</span></span><br><span class="line"><span class="string">Greetings, KubeKey!</span></span><br><span class="line"><span class="string">15:26:06 CST success: [k3s-worker-02]</span></span><br><span class="line"><span class="string">15:26:06 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">15:26:06 CST success: [k3s-worker-01]</span></span><br><span class="line"><span class="string">15:26:06 CST [NodePreCheckModule] A pre-check on nodes</span></span><br><span class="line"><span class="string">15:26:06 CST success: [k3s-worker-01]</span></span><br><span class="line"><span class="string">15:26:06 CST success: [k3s-worker-02]</span></span><br><span class="line"><span class="string">15:26:06 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">15:26:06 CST [ConfirmModule] Display confirmation form</span></span><br><span class="line"><span class="string">+---------------+------+------+---------+----------+-------+-------+---------+-----------+--------+--------+------------+------------+-------------+------------------+--------------+</span></span><br><span class="line"><span class="string">| name          | sudo | curl | openssl | ebtables | socat | ipset | ipvsadm | conntrack | chrony | docker | containerd | nfs client | ceph client | glusterfs client | time         |</span></span><br><span class="line"><span class="string">+---------------+------+------+---------+----------+-------+-------+---------+-----------+--------+--------+------------+------------+-------------+------------------+--------------+</span></span><br><span class="line"><span class="string">| k3s-master    | y    | y    | y       | y        | y     | y     | y       | y         | y      |        | v1.7.13    | y          |             |                  | CST 15:26:06 |</span></span><br><span class="line"><span class="string">| k3s-worker-01 | y    | y    | y       | y        | y     | y     | y       | y         | y      |        | v1.7.13    | y          |             |                  | CST 15:26:06 |</span></span><br><span class="line"><span class="string">| k3s-worker-02 | y    | y    | y       | y        | y     | y     | y       | y         | y      |        | v1.7.13    | y          |             |                  | CST 15:26:06 |</span></span><br><span class="line"><span class="string">+---------------+------+------+---------+----------+-------+-------+---------+-----------+--------+--------+------------+------------+-------------+------------------+--------------+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">This is a simple check of your environment.</span></span><br><span class="line"><span class="string">Before installation, ensure that your machines meet all requirements specified at</span></span><br><span class="line"><span class="string">https://github.com/kubesphere/kubekey#requirements-and-recommendations</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Install k8s with specify version:  v1.24.17</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Continue this installation? [yes/no]: yes</span></span><br><span class="line"><span class="string">15:26:08 CST success: [LocalHost]</span></span><br><span class="line"><span class="string">15:26:08 CST [NodeBinariesModule] Download installation binaries</span></span><br><span class="line"><span class="string">15:26:08 CST message: [localhost]</span></span><br><span class="line"><span class="string">downloading amd64 kubeadm v1.24.17 ...</span></span><br><span class="line"><span class="string">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span></span><br><span class="line"><span class="string">                                 Dload  Upload   Total   Spent    Left  Speed</span></span><br><span class="line"><span class="string">100 43.4M  100 43.4M    0     0   904k      0  0:00:49  0:00:49 --:--:-- 1084k</span></span><br><span class="line"><span class="string">15:26:57 CST message: [localhost]</span></span><br><span class="line"><span class="string">downloading amd64 kubelet v1.24.17 ...</span></span><br><span class="line"><span class="string">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span></span><br><span class="line"><span class="string">                                 Dload  Upload   Total   Spent    Left  Speed</span></span><br><span class="line"><span class="string">100  112M  100  112M    0     0   973k      0  0:01:58  0:01:58 --:--:-- 1088k</span></span><br><span class="line"><span class="string">15:28:56 CST message: [localhost]</span></span><br><span class="line"><span class="string">downloading amd64 kubectl v1.24.17 ...</span></span><br><span class="line"><span class="string">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span></span><br><span class="line"><span class="string">                                 Dload  Upload   Total   Spent    Left  Speed</span></span><br><span class="line"><span class="string">100 44.5M  100 44.5M    0     0   910k      0  0:00:50  0:00:50 --:--:-- 1087k</span></span><br><span class="line"><span class="string">15:29:47 CST message: [localhost]</span></span><br><span class="line"><span class="string">downloading amd64 helm v3.14.3 ...</span></span><br><span class="line"><span class="string">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span></span><br><span class="line"><span class="string">                                 Dload  Upload   Total   Spent    Left  Speed</span></span><br><span class="line"><span class="string">100 48.3M  100 48.3M    0     0   915k      0  0:00:54  0:00:54 --:--:-- 1076k</span></span><br><span class="line"><span class="string">15:30:41 CST message: [localhost]</span></span><br><span class="line"><span class="string">downloading amd64 kubecni v1.2.0 ...</span></span><br><span class="line"><span class="string">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span></span><br><span class="line"><span class="string">                                 Dload  Upload   Total   Spent    Left  Speed</span></span><br><span class="line"><span class="string">100 38.6M  100 38.6M    0     0   893k      0  0:00:44  0:00:44 --:--:-- 1088k</span></span><br><span class="line"><span class="string">15:31:25 CST message: [localhost]</span></span><br><span class="line"><span class="string">downloading amd64 crictl v1.29.0 ...</span></span><br><span class="line"><span class="string">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span></span><br><span class="line"><span class="string">                                 Dload  Upload   Total   Spent    Left  Speed</span></span><br><span class="line"><span class="string">100 23.2M  100 23.2M    0     0   821k      0  0:00:28  0:00:28 --:--:-- 1065k</span></span><br><span class="line"><span class="string">15:31:54 CST message: [localhost]</span></span><br><span class="line"><span class="string">downloading amd64 etcd v3.5.13 ...</span></span><br><span class="line"><span class="string">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span></span><br><span class="line"><span class="string">                                 Dload  Upload   Total   Spent    Left  Speed</span></span><br><span class="line"><span class="string">100 19.1M  100 19.1M    0     0   789k      0  0:00:24  0:00:24 --:--:-- 1062k</span></span><br><span class="line"><span class="string">15:32:19 CST message: [localhost]</span></span><br><span class="line"><span class="string">downloading amd64 containerd 1.7.13 ...</span></span><br><span class="line"><span class="string">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span></span><br><span class="line"><span class="string">                                 Dload  Upload   Total   Spent    Left  Speed</span></span><br><span class="line"><span class="string">100 45.7M  100 45.7M    0     0   910k      0  0:00:51  0:00:51 --:--:-- 1077k</span></span><br><span class="line"><span class="string">15:33:11 CST message: [localhost]</span></span><br><span class="line"><span class="string">downloading amd64 runc v1.1.12 ...</span></span><br><span class="line"><span class="string">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span></span><br><span class="line"><span class="string">                                 Dload  Upload   Total   Spent    Left  Speed</span></span><br><span class="line"><span class="string">100 10.2M  100 10.2M    0     0   660k      0  0:00:15  0:00:15 --:--:-- 1078k</span></span><br><span class="line"><span class="string">15:33:27 CST message: [localhost]</span></span><br><span class="line"><span class="string">downloading amd64 calicoctl v3.27.4 ...</span></span><br><span class="line"><span class="string">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span></span><br><span class="line"><span class="string">                                 Dload  Upload   Total   Spent    Left  Speed</span></span><br><span class="line"><span class="string">100 61.3M  100 61.3M    0     0   933k      0  0:01:07  0:01:07 --:--:-- 1026k</span></span><br><span class="line"><span class="string">15:34:34 CST success: [LocalHost]</span></span><br><span class="line"><span class="string">15:34:34 CST [ConfigureOSModule] Get OS release</span></span><br><span class="line"><span class="string">15:34:34 CST success: [k3s-worker-02]</span></span><br><span class="line"><span class="string">15:34:34 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">15:34:34 CST success: [k3s-worker-01]</span></span><br><span class="line"><span class="string">15:34:34 CST [ConfigureOSModule] Prepare to init OS</span></span><br><span class="line"><span class="string">15:34:36 CST success: [k3s-worker-02]</span></span><br><span class="line"><span class="string">15:34:36 CST success: [k3s-worker-01]</span></span><br><span class="line"><span class="string">15:34:36 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">15:34:36 CST [ConfigureOSModule] Generate init os script</span></span><br><span class="line"><span class="string">15:34:36 CST success: [k3s-worker-02]</span></span><br><span class="line"><span class="string">15:34:36 CST success: [k3s-worker-01]</span></span><br><span class="line"><span class="string">15:34:36 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">15:34:36 CST [ConfigureOSModule] Exec init os script</span></span><br><span class="line"><span class="string">15:34:39 CST stdout: [k3s-worker-01]</span></span><br><span class="line"><span class="string">setenforce: SELinux is disabled</span></span><br><span class="line"><span class="string">Disabled</span></span><br><span class="line"><span class="string">net.ipv4.tcp_syncookies = 1</span></span><br><span class="line"><span class="string">net.ipv4.conf.all.accept_source_route = 0</span></span><br><span class="line"><span class="string">net.ipv4.conf.all.accept_redirects = 0</span></span><br><span class="line"><span class="string">net.ipv4.conf.all.rp_filter = 0</span></span><br><span class="line"><span class="string">net.ipv4.icmp_echo_ignore_broadcasts = 1</span></span><br><span class="line"><span class="string">net.ipv4.icmp_ignore_bogus_error_responses = 1</span></span><br><span class="line"><span class="string">kernel.sched_child_runs_first = 1</span></span><br><span class="line"><span class="string">kernel.sched_latency_ns = 80000000</span></span><br><span class="line"><span class="string">kernel.sched_migration_cost_ns = 125000</span></span><br><span class="line"><span class="string">kernel.sched_min_granularity_ns = 40000000</span></span><br><span class="line"><span class="string">kernel.sched_wakeup_granularity_ns = 3750000</span></span><br><span class="line"><span class="string">kernel.sched_nr_migrate = 128</span></span><br><span class="line"><span class="string">kernel.pid_max = 65535</span></span><br><span class="line"><span class="string">kernel.msgmax = 2097152</span></span><br><span class="line"><span class="string">kernel.msgmnb = 4194304</span></span><br><span class="line"><span class="string">kernel.shmmni = 32768</span></span><br><span class="line"><span class="string">kernel.sem = 2000 256000 256 1024</span></span><br><span class="line"><span class="string">vm.overcommit_memory = 0</span></span><br><span class="line"><span class="string">vm.max_map_count = 262144</span></span><br><span class="line"><span class="string">vm.swappiness = 0</span></span><br><span class="line"><span class="string">vm.dirty_background_ratio = 40</span></span><br><span class="line"><span class="string">vm.dirty_ratio = 50</span></span><br><span class="line"><span class="string">fs.aio-max-nr = 262144</span></span><br><span class="line"><span class="string">fs.inotify.max_user_instances = 524288</span></span><br><span class="line"><span class="string">fs.inotify.max_user_watches = 524288</span></span><br><span class="line"><span class="string">net.core.rps_sock_flow_entries = 65536</span></span><br><span class="line"><span class="string">net.core.dev_weight = 1024</span></span><br><span class="line"><span class="string">net.core.busy_poll = 200</span></span><br><span class="line"><span class="string">net.core.busy_read = 200</span></span><br><span class="line"><span class="string">net.ipv4.tcp_moderate_rcvbuf = 1</span></span><br><span class="line"><span class="string">net.core.somaxconn = 32768</span></span><br><span class="line"><span class="string">net.core.netdev_max_backlog = 65535</span></span><br><span class="line"><span class="string">net.core.netdev_budget = 4800</span></span><br><span class="line"><span class="string">net.ipv4.neigh.default.gc_thresh1 = 512</span></span><br><span class="line"><span class="string">net.ipv4.neigh.default.gc_thresh2 = 2048</span></span><br><span class="line"><span class="string">net.ipv4.neigh.default.gc_thresh3 = 4096</span></span><br><span class="line"><span class="string">net.ipv4.neigh.default.unres_qlen_bytes = 262144</span></span><br><span class="line"><span class="string">net.netfilter.nf_conntrack_max = 1048576</span></span><br><span class="line"><span class="string">net.netfilter.nf_conntrack_tcp_timeout_established = 300</span></span><br><span class="line"><span class="string">sysctl: setting key &quot;net.netfilter.nf_conntrack_buckets&quot;: No such file or directory</span></span><br><span class="line"><span class="string">net.ipv4.ipfrag_high_thresh = 16777216</span></span><br><span class="line"><span class="string">net.ipv4.ipfrag_low_thresh = 12582912</span></span><br><span class="line"><span class="string">net.ipv4.tcp_rmem = 8388608 16777216 67108864</span></span><br><span class="line"><span class="string">net.ipv4.tcp_wmem = 8388608 16777216 67108864</span></span><br><span class="line"><span class="string">net.ipv4.udp_rmem_min = 131072</span></span><br><span class="line"><span class="string">net.ipv4.udp_wmem_min = 131072</span></span><br><span class="line"><span class="string">net.core.rmem_default = 33554432</span></span><br><span class="line"><span class="string">net.core.wmem_default = 33554432</span></span><br><span class="line"><span class="string">net.core.rmem_max = 33554432</span></span><br><span class="line"><span class="string">net.core.wmem_max = 33554432</span></span><br><span class="line"><span class="string">net.ipv4.tcp_fin_timeout = 5</span></span><br><span class="line"><span class="string">net.ipv4.tcp_keepalive_time = 600</span></span><br><span class="line"><span class="string">net.ipv4.ip_local_port_range = 10000 65000</span></span><br><span class="line"><span class="string">net.ipv4.tcp_max_syn_backlog = 1048576</span></span><br><span class="line"><span class="string">net.ipv4.tcp_max_tw_buckets = 1048576</span></span><br><span class="line"><span class="string">net.ipv4.ip_forward = 1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-arptables = 1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-ip6tables = 1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables = 1</span></span><br><span class="line"><span class="string">net.ipv4.ip_local_reserved_ports = 30000-32767</span></span><br><span class="line"><span class="string">net.ipv4.tcp_retries2 = 15</span></span><br><span class="line"><span class="string">net.ipv4.tcp_max_orphans = 65535</span></span><br><span class="line"><span class="string">net.ipv4.tcp_keepalive_intvl = 30</span></span><br><span class="line"><span class="string">net.ipv4.tcp_keepalive_probes = 10</span></span><br><span class="line"><span class="string">net.ipv4.conf.default.rp_filter = 0</span></span><br><span class="line"><span class="string">net.ipv4.conf.all.arp_accept = 1</span></span><br><span class="line"><span class="string">net.ipv4.conf.default.arp_accept = 1</span></span><br><span class="line"><span class="string">net.ipv4.conf.all.arp_ignore = 1</span></span><br><span class="line"><span class="string">net.ipv4.conf.default.arp_ignore = 1</span></span><br><span class="line"><span class="string">fs.pipe-max-size = 4194304</span></span><br><span class="line"><span class="string">kernel.watchdog_thresh = 5</span></span><br><span class="line"><span class="string">kernel.hung_task_timeout_secs = 5</span></span><br><span class="line"><span class="string">net.ipv6.conf.all.disable_ipv6 = 0</span></span><br><span class="line"><span class="string">net.ipv6.conf.default.disable_ipv6 = 0</span></span><br><span class="line"><span class="string">net.ipv6.conf.lo.disable_ipv6 = 0</span></span><br><span class="line"><span class="string">net.ipv6.conf.all.forwarding = 1</span></span><br><span class="line"><span class="string">15:34:39 CST stdout: [k3s-worker-02]</span></span><br><span class="line"><span class="string">setenforce: SELinux is disabled</span></span><br><span class="line"><span class="string">Disabled</span></span><br><span class="line"><span class="string">net.ipv4.tcp_syncookies = 1</span></span><br><span class="line"><span class="string">net.ipv4.conf.all.accept_source_route = 0</span></span><br><span class="line"><span class="string">net.ipv4.conf.all.accept_redirects = 0</span></span><br><span class="line"><span class="string">net.ipv4.conf.all.rp_filter = 0</span></span><br><span class="line"><span class="string">net.ipv4.icmp_echo_ignore_broadcasts = 1</span></span><br><span class="line"><span class="string">net.ipv4.icmp_ignore_bogus_error_responses = 1</span></span><br><span class="line"><span class="string">kernel.sched_child_runs_first = 1</span></span><br><span class="line"><span class="string">kernel.sched_latency_ns = 80000000</span></span><br><span class="line"><span class="string">kernel.sched_migration_cost_ns = 125000</span></span><br><span class="line"><span class="string">kernel.sched_min_granularity_ns = 40000000</span></span><br><span class="line"><span class="string">kernel.sched_wakeup_granularity_ns = 3750000</span></span><br><span class="line"><span class="string">kernel.sched_nr_migrate = 128</span></span><br><span class="line"><span class="string">kernel.pid_max = 65535</span></span><br><span class="line"><span class="string">kernel.msgmax = 2097152</span></span><br><span class="line"><span class="string">kernel.msgmnb = 4194304</span></span><br><span class="line"><span class="string">kernel.shmmni = 32768</span></span><br><span class="line"><span class="string">kernel.sem = 2000 256000 256 1024</span></span><br><span class="line"><span class="string">vm.overcommit_memory = 0</span></span><br><span class="line"><span class="string">vm.max_map_count = 262144</span></span><br><span class="line"><span class="string">vm.swappiness = 0</span></span><br><span class="line"><span class="string">vm.dirty_background_ratio = 40</span></span><br><span class="line"><span class="string">vm.dirty_ratio = 50</span></span><br><span class="line"><span class="string">fs.aio-max-nr = 262144</span></span><br><span class="line"><span class="string">fs.inotify.max_user_instances = 524288</span></span><br><span class="line"><span class="string">fs.inotify.max_user_watches = 524288</span></span><br><span class="line"><span class="string">net.core.rps_sock_flow_entries = 65536</span></span><br><span class="line"><span class="string">net.core.dev_weight = 1024</span></span><br><span class="line"><span class="string">net.core.busy_poll = 200</span></span><br><span class="line"><span class="string">net.core.busy_read = 200</span></span><br><span class="line"><span class="string">net.ipv4.tcp_moderate_rcvbuf = 1</span></span><br><span class="line"><span class="string">net.core.somaxconn = 32768</span></span><br><span class="line"><span class="string">net.core.netdev_max_backlog = 65535</span></span><br><span class="line"><span class="string">net.core.netdev_budget = 4800</span></span><br><span class="line"><span class="string">net.ipv4.neigh.default.gc_thresh1 = 512</span></span><br><span class="line"><span class="string">net.ipv4.neigh.default.gc_thresh2 = 2048</span></span><br><span class="line"><span class="string">net.ipv4.neigh.default.gc_thresh3 = 4096</span></span><br><span class="line"><span class="string">net.ipv4.neigh.default.unres_qlen_bytes = 262144</span></span><br><span class="line"><span class="string">net.netfilter.nf_conntrack_max = 1048576</span></span><br><span class="line"><span class="string">net.netfilter.nf_conntrack_tcp_timeout_established = 300</span></span><br><span class="line"><span class="string">sysctl: setting key &quot;net.netfilter.nf_conntrack_buckets&quot;: No such file or directory</span></span><br><span class="line"><span class="string">net.ipv4.ipfrag_high_thresh = 16777216</span></span><br><span class="line"><span class="string">net.ipv4.ipfrag_low_thresh = 12582912</span></span><br><span class="line"><span class="string">net.ipv4.tcp_rmem = 8388608 16777216 67108864</span></span><br><span class="line"><span class="string">net.ipv4.tcp_wmem = 8388608 16777216 67108864</span></span><br><span class="line"><span class="string">net.ipv4.udp_rmem_min = 131072</span></span><br><span class="line"><span class="string">net.ipv4.udp_wmem_min = 131072</span></span><br><span class="line"><span class="string">net.core.rmem_default = 33554432</span></span><br><span class="line"><span class="string">net.core.wmem_default = 33554432</span></span><br><span class="line"><span class="string">net.core.rmem_max = 33554432</span></span><br><span class="line"><span class="string">net.core.wmem_max = 33554432</span></span><br><span class="line"><span class="string">net.ipv4.tcp_fin_timeout = 5</span></span><br><span class="line"><span class="string">net.ipv4.tcp_keepalive_time = 600</span></span><br><span class="line"><span class="string">net.ipv4.ip_local_port_range = 10000 65000</span></span><br><span class="line"><span class="string">net.ipv4.tcp_max_syn_backlog = 1048576</span></span><br><span class="line"><span class="string">net.ipv4.tcp_max_tw_buckets = 1048576</span></span><br><span class="line"><span class="string">net.ipv4.ip_forward = 1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-arptables = 1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-ip6tables = 1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables = 1</span></span><br><span class="line"><span class="string">net.ipv4.ip_local_reserved_ports = 30000-32767</span></span><br><span class="line"><span class="string">net.ipv4.tcp_retries2 = 15</span></span><br><span class="line"><span class="string">net.ipv4.tcp_max_orphans = 65535</span></span><br><span class="line"><span class="string">net.ipv4.tcp_keepalive_intvl = 30</span></span><br><span class="line"><span class="string">net.ipv4.tcp_keepalive_probes = 10</span></span><br><span class="line"><span class="string">net.ipv4.conf.default.rp_filter = 0</span></span><br><span class="line"><span class="string">net.ipv4.conf.all.arp_accept = 1</span></span><br><span class="line"><span class="string">net.ipv4.conf.default.arp_accept = 1</span></span><br><span class="line"><span class="string">net.ipv4.conf.all.arp_ignore = 1</span></span><br><span class="line"><span class="string">net.ipv4.conf.default.arp_ignore = 1</span></span><br><span class="line"><span class="string">fs.pipe-max-size = 4194304</span></span><br><span class="line"><span class="string">kernel.watchdog_thresh = 5</span></span><br><span class="line"><span class="string">kernel.hung_task_timeout_secs = 5</span></span><br><span class="line"><span class="string">net.ipv6.conf.all.disable_ipv6 = 0</span></span><br><span class="line"><span class="string">net.ipv6.conf.default.disable_ipv6 = 0</span></span><br><span class="line"><span class="string">net.ipv6.conf.lo.disable_ipv6 = 0</span></span><br><span class="line"><span class="string">net.ipv6.conf.all.forwarding = 1</span></span><br><span class="line"><span class="string">15:34:40 CST stdout: [k3s-master]</span></span><br><span class="line"><span class="string">setenforce: SELinux is disabled</span></span><br><span class="line"><span class="string">Disabled</span></span><br><span class="line"><span class="string">net.ipv4.tcp_syncookies = 1</span></span><br><span class="line"><span class="string">net.ipv4.conf.all.accept_source_route = 0</span></span><br><span class="line"><span class="string">net.ipv4.conf.all.accept_redirects = 0</span></span><br><span class="line"><span class="string">net.ipv4.conf.all.rp_filter = 0</span></span><br><span class="line"><span class="string">net.ipv4.icmp_echo_ignore_broadcasts = 1</span></span><br><span class="line"><span class="string">net.ipv4.icmp_ignore_bogus_error_responses = 1</span></span><br><span class="line"><span class="string">kernel.sched_child_runs_first = 1</span></span><br><span class="line"><span class="string">kernel.sched_latency_ns = 80000000</span></span><br><span class="line"><span class="string">kernel.sched_migration_cost_ns = 125000</span></span><br><span class="line"><span class="string">kernel.sched_min_granularity_ns = 40000000</span></span><br><span class="line"><span class="string">kernel.sched_wakeup_granularity_ns = 3750000</span></span><br><span class="line"><span class="string">kernel.sched_nr_migrate = 128</span></span><br><span class="line"><span class="string">kernel.pid_max = 65535</span></span><br><span class="line"><span class="string">kernel.msgmax = 2097152</span></span><br><span class="line"><span class="string">kernel.msgmnb = 4194304</span></span><br><span class="line"><span class="string">kernel.shmmni = 32768</span></span><br><span class="line"><span class="string">kernel.sem = 2000 256000 256 1024</span></span><br><span class="line"><span class="string">vm.overcommit_memory = 0</span></span><br><span class="line"><span class="string">vm.max_map_count = 262144</span></span><br><span class="line"><span class="string">vm.swappiness = 0</span></span><br><span class="line"><span class="string">vm.dirty_background_ratio = 40</span></span><br><span class="line"><span class="string">vm.dirty_ratio = 50</span></span><br><span class="line"><span class="string">fs.aio-max-nr = 262144</span></span><br><span class="line"><span class="string">fs.inotify.max_user_instances = 524288</span></span><br><span class="line"><span class="string">fs.inotify.max_user_watches = 524288</span></span><br><span class="line"><span class="string">net.core.rps_sock_flow_entries = 65536</span></span><br><span class="line"><span class="string">net.core.dev_weight = 1024</span></span><br><span class="line"><span class="string">net.core.busy_poll = 200</span></span><br><span class="line"><span class="string">net.core.busy_read = 200</span></span><br><span class="line"><span class="string">net.ipv4.tcp_moderate_rcvbuf = 1</span></span><br><span class="line"><span class="string">net.core.somaxconn = 32768</span></span><br><span class="line"><span class="string">net.core.netdev_max_backlog = 65535</span></span><br><span class="line"><span class="string">net.core.netdev_budget = 4800</span></span><br><span class="line"><span class="string">net.ipv4.neigh.default.gc_thresh1 = 512</span></span><br><span class="line"><span class="string">net.ipv4.neigh.default.gc_thresh2 = 2048</span></span><br><span class="line"><span class="string">net.ipv4.neigh.default.gc_thresh3 = 4096</span></span><br><span class="line"><span class="string">net.ipv4.neigh.default.unres_qlen_bytes = 262144</span></span><br><span class="line"><span class="string">net.netfilter.nf_conntrack_max = 1048576</span></span><br><span class="line"><span class="string">net.netfilter.nf_conntrack_tcp_timeout_established = 300</span></span><br><span class="line"><span class="string">sysctl: setting key &quot;net.netfilter.nf_conntrack_buckets&quot;: No such file or directory</span></span><br><span class="line"><span class="string">net.ipv4.ipfrag_high_thresh = 16777216</span></span><br><span class="line"><span class="string">net.ipv4.ipfrag_low_thresh = 12582912</span></span><br><span class="line"><span class="string">net.ipv4.tcp_rmem = 8388608 16777216 67108864</span></span><br><span class="line"><span class="string">net.ipv4.tcp_wmem = 8388608 16777216 67108864</span></span><br><span class="line"><span class="string">net.ipv4.udp_rmem_min = 131072</span></span><br><span class="line"><span class="string">net.ipv4.udp_wmem_min = 131072</span></span><br><span class="line"><span class="string">net.core.rmem_default = 33554432</span></span><br><span class="line"><span class="string">net.core.wmem_default = 33554432</span></span><br><span class="line"><span class="string">net.core.rmem_max = 33554432</span></span><br><span class="line"><span class="string">net.core.wmem_max = 33554432</span></span><br><span class="line"><span class="string">net.ipv4.tcp_fin_timeout = 5</span></span><br><span class="line"><span class="string">net.ipv4.tcp_keepalive_time = 600</span></span><br><span class="line"><span class="string">net.ipv4.ip_local_port_range = 10000 65000</span></span><br><span class="line"><span class="string">net.ipv4.tcp_max_syn_backlog = 1048576</span></span><br><span class="line"><span class="string">net.ipv4.tcp_max_tw_buckets = 1048576</span></span><br><span class="line"><span class="string">net.ipv4.ip_forward = 1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-arptables = 1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-ip6tables = 1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables = 1</span></span><br><span class="line"><span class="string">net.ipv4.ip_local_reserved_ports = 30000-32767</span></span><br><span class="line"><span class="string">net.ipv4.tcp_retries2 = 15</span></span><br><span class="line"><span class="string">net.ipv4.tcp_max_orphans = 65535</span></span><br><span class="line"><span class="string">net.ipv4.tcp_keepalive_intvl = 30</span></span><br><span class="line"><span class="string">net.ipv4.tcp_keepalive_probes = 10</span></span><br><span class="line"><span class="string">net.ipv4.conf.default.rp_filter = 0</span></span><br><span class="line"><span class="string">net.ipv4.conf.all.arp_accept = 1</span></span><br><span class="line"><span class="string">net.ipv4.conf.default.arp_accept = 1</span></span><br><span class="line"><span class="string">net.ipv4.conf.all.arp_ignore = 1</span></span><br><span class="line"><span class="string">net.ipv4.conf.default.arp_ignore = 1</span></span><br><span class="line"><span class="string">fs.pipe-max-size = 4194304</span></span><br><span class="line"><span class="string">kernel.watchdog_thresh = 5</span></span><br><span class="line"><span class="string">kernel.hung_task_timeout_secs = 5</span></span><br><span class="line"><span class="string">net.ipv6.conf.all.disable_ipv6 = 0</span></span><br><span class="line"><span class="string">net.ipv6.conf.default.disable_ipv6 = 0</span></span><br><span class="line"><span class="string">net.ipv6.conf.lo.disable_ipv6 = 0</span></span><br><span class="line"><span class="string">net.ipv6.conf.all.forwarding = 1</span></span><br><span class="line"><span class="string">15:34:40 CST success: [k3s-worker-01]</span></span><br><span class="line"><span class="string">15:34:40 CST success: [k3s-worker-02]</span></span><br><span class="line"><span class="string">15:34:40 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">15:34:40 CST [ConfigureOSModule] configure the ntp server for each node</span></span><br><span class="line"><span class="string">15:34:40 CST skipped: [k3s-worker-01]</span></span><br><span class="line"><span class="string">15:34:40 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">15:34:40 CST skipped: [k3s-worker-02]</span></span><br><span class="line"><span class="string">15:34:40 CST [KubernetesStatusModule] Get kubernetes cluster status</span></span><br><span class="line"><span class="string">15:34:41 CST stdout: [k3s-master]</span></span><br><span class="line"><span class="string">v1.24.17</span></span><br><span class="line"><span class="string">15:34:41 CST stdout: [k3s-master]</span></span><br><span class="line"><span class="string">k3s-master      v1.24.17   [map[address:10.2.2.109 type:InternalIP] map[address:k3s-master type:Hostname]]</span></span><br><span class="line"><span class="string">k3s-worker-01   v1.24.17   [map[address:10.2.2.140 type:InternalIP] map[address:k3s-worker-01 type:Hostname]]</span></span><br><span class="line"><span class="string">15:34:42 CST stdout: [k3s-master]</span></span><br><span class="line"><span class="string">W1009 15:34:42.019455   34906 utils.go:69] The recommended value for &quot;clusterDNS&quot; in &quot;KubeletConfiguration&quot; is: [10.233.0.10]; the provided value is: [169.254.25.10]</span></span><br><span class="line"><span class="string">[upload-certs] Storing the certificates in Secret &quot;kubeadm-certs&quot; in the &quot;kube-system&quot; Namespace</span></span><br><span class="line"><span class="string">[upload-certs] Using certificate key:</span></span><br><span class="line"><span class="string">56a046cb392827bf42cec14effc1b0d27c3722e741e53ff9c5139d4c943b9efd</span></span><br><span class="line"><span class="string">15:34:42 CST stdout: [k3s-master]</span></span><br><span class="line"><span class="string">secret/kubeadm-certs patched</span></span><br><span class="line"><span class="string">15:34:42 CST stdout: [k3s-master]</span></span><br><span class="line"><span class="string">secret/kubeadm-certs patched</span></span><br><span class="line"><span class="string">15:34:42 CST stdout: [k3s-master]</span></span><br><span class="line"><span class="string">secret/kubeadm-certs patched</span></span><br><span class="line"><span class="string">15:34:43 CST stdout: [k3s-master]</span></span><br><span class="line"><span class="string">0x3xku.uqjzfg1xclpwfkey</span></span><br><span class="line"><span class="string">15:34:43 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">15:34:43 CST [InstallContainerModule] Sync containerd binaries</span></span><br><span class="line"><span class="string">15:34:43 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">15:34:43 CST skipped: [k3s-worker-01]</span></span><br><span class="line"><span class="string">15:34:43 CST skipped: [k3s-worker-02]</span></span><br><span class="line"><span class="string">15:34:43 CST [InstallContainerModule] Generate containerd service</span></span><br><span class="line"><span class="string">15:34:43 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">15:34:43 CST skipped: [k3s-worker-01]</span></span><br><span class="line"><span class="string">15:34:43 CST skipped: [k3s-worker-02]</span></span><br><span class="line"><span class="string">15:34:43 CST [InstallContainerModule] Generate containerd config</span></span><br><span class="line"><span class="string">15:34:43 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">15:34:43 CST skipped: [k3s-worker-01]</span></span><br><span class="line"><span class="string">15:34:43 CST skipped: [k3s-worker-02]</span></span><br><span class="line"><span class="string">15:34:43 CST [InstallContainerModule] Enable containerd</span></span><br><span class="line"><span class="string">15:34:43 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">15:34:43 CST skipped: [k3s-worker-01]</span></span><br><span class="line"><span class="string">15:34:43 CST skipped: [k3s-worker-02]</span></span><br><span class="line"><span class="string">15:34:43 CST [InstallContainerModule] Sync crictl binaries</span></span><br><span class="line"><span class="string">15:34:44 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">15:34:44 CST skipped: [k3s-worker-01]</span></span><br><span class="line"><span class="string">15:34:44 CST skipped: [k3s-worker-02]</span></span><br><span class="line"><span class="string">15:34:44 CST [InstallContainerModule] Generate crictl config</span></span><br><span class="line"><span class="string">15:34:44 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">15:34:44 CST skipped: [k3s-worker-01]</span></span><br><span class="line"><span class="string">15:34:44 CST success: [k3s-worker-02]</span></span><br><span class="line"><span class="string">15:34:44 CST [PullModule] Start to pull images on all nodes</span></span><br><span class="line"><span class="string">15:34:44 CST message: [k3s-worker-01]</span></span><br><span class="line"><span class="string">downloading image: registry.cn-beijing.aliyuncs.com/kubesphereio/pause:3.7</span></span><br><span class="line"><span class="string">15:34:44 CST message: [k3s-master]</span></span><br><span class="line"><span class="string">downloading image: registry.cn-beijing.aliyuncs.com/kubesphereio/pause:3.7</span></span><br><span class="line"><span class="string">15:34:44 CST message: [k3s-worker-02]</span></span><br><span class="line"><span class="string">downloading image: registry.cn-beijing.aliyuncs.com/kubesphereio/pause:3.7</span></span><br><span class="line"><span class="string">15:34:44 CST message: [k3s-worker-02]</span></span><br><span class="line"><span class="string">downloading image: registry.cn-beijing.aliyuncs.com/kubesphereio/kube-proxy:v1.24.17</span></span><br><span class="line"><span class="string">15:34:44 CST message: [k3s-worker-02]</span></span><br><span class="line"><span class="string">downloading image: registry.cn-beijing.aliyuncs.com/kubesphereio/coredns:1.8.6</span></span><br><span class="line"><span class="string">15:34:44 CST message: [k3s-worker-02]</span></span><br><span class="line"><span class="string">downloading image: registry.cn-beijing.aliyuncs.com/kubesphereio/k8s-dns-node-cache:1.22.20</span></span><br><span class="line"><span class="string">15:34:44 CST message: [k3s-master]</span></span><br><span class="line"><span class="string">downloading image: registry.cn-beijing.aliyuncs.com/kubesphereio/kube-apiserver:v1.24.17</span></span><br><span class="line"><span class="string">15:34:44 CST message: [k3s-worker-02]</span></span><br><span class="line"><span class="string">downloading image: registry.cn-beijing.aliyuncs.com/kubesphereio/kube-controllers:v3.27.4</span></span><br><span class="line"><span class="string">15:34:44 CST message: [k3s-worker-02]</span></span><br><span class="line"><span class="string">downloading image: registry.cn-beijing.aliyuncs.com/kubesphereio/cni:v3.27.4</span></span><br><span class="line"><span class="string">15:34:44 CST message: [k3s-master]</span></span><br><span class="line"><span class="string">downloading image: registry.cn-beijing.aliyuncs.com/kubesphereio/kube-controller-manager:v1.24.17</span></span><br><span class="line"><span class="string">15:34:44 CST message: [k3s-worker-02]</span></span><br><span class="line"><span class="string">downloading image: registry.cn-beijing.aliyuncs.com/kubesphereio/node:v3.27.4</span></span><br><span class="line"><span class="string">15:34:44 CST message: [k3s-master]</span></span><br><span class="line"><span class="string">downloading image: registry.cn-beijing.aliyuncs.com/kubesphereio/kube-scheduler:v1.24.17</span></span><br><span class="line"><span class="string">15:34:44 CST message: [k3s-worker-02]</span></span><br><span class="line"><span class="string">downloading image: registry.cn-beijing.aliyuncs.com/kubesphereio/pod2daemon-flexvol:v3.27.4</span></span><br><span class="line"><span class="string">15:34:44 CST message: [k3s-master]</span></span><br><span class="line"><span class="string">downloading image: registry.cn-beijing.aliyuncs.com/kubesphereio/kube-proxy:v1.24.17</span></span><br><span class="line"><span class="string">15:34:45 CST message: [k3s-master]</span></span><br><span class="line"><span class="string">downloading image: registry.cn-beijing.aliyuncs.com/kubesphereio/coredns:1.8.6</span></span><br><span class="line"><span class="string">15:34:45 CST message: [k3s-master]</span></span><br><span class="line"><span class="string">downloading image: registry.cn-beijing.aliyuncs.com/kubesphereio/k8s-dns-node-cache:1.22.20</span></span><br><span class="line"><span class="string">15:34:45 CST message: [k3s-master]</span></span><br><span class="line"><span class="string">downloading image: registry.cn-beijing.aliyuncs.com/kubesphereio/kube-controllers:v3.27.4</span></span><br><span class="line"><span class="string">15:34:45 CST message: [k3s-master]</span></span><br><span class="line"><span class="string">downloading image: registry.cn-beijing.aliyuncs.com/kubesphereio/cni:v3.27.4</span></span><br><span class="line"><span class="string">15:34:45 CST message: [k3s-master]</span></span><br><span class="line"><span class="string">downloading image: registry.cn-beijing.aliyuncs.com/kubesphereio/node:v3.27.4</span></span><br><span class="line"><span class="string">15:34:45 CST message: [k3s-master]</span></span><br><span class="line"><span class="string">downloading image: registry.cn-beijing.aliyuncs.com/kubesphereio/pod2daemon-flexvol:v3.27.4</span></span><br><span class="line"><span class="string">15:34:46 CST message: [k3s-worker-01]</span></span><br><span class="line"><span class="string">downloading image: registry.cn-beijing.aliyuncs.com/kubesphereio/kube-proxy:v1.24.17</span></span><br><span class="line"><span class="string">15:34:46 CST message: [k3s-worker-01]</span></span><br><span class="line"><span class="string">downloading image: registry.cn-beijing.aliyuncs.com/kubesphereio/coredns:1.8.6</span></span><br><span class="line"><span class="string">15:34:46 CST message: [k3s-worker-01]</span></span><br><span class="line"><span class="string">downloading image: registry.cn-beijing.aliyuncs.com/kubesphereio/k8s-dns-node-cache:1.22.20</span></span><br><span class="line"><span class="string">15:34:46 CST message: [k3s-worker-01]</span></span><br><span class="line"><span class="string">downloading image: registry.cn-beijing.aliyuncs.com/kubesphereio/kube-controllers:v3.27.4</span></span><br><span class="line"><span class="string">15:34:46 CST message: [k3s-worker-01]</span></span><br><span class="line"><span class="string">downloading image: registry.cn-beijing.aliyuncs.com/kubesphereio/cni:v3.27.4</span></span><br><span class="line"><span class="string">15:34:46 CST message: [k3s-worker-01]</span></span><br><span class="line"><span class="string">downloading image: registry.cn-beijing.aliyuncs.com/kubesphereio/node:v3.27.4</span></span><br><span class="line"><span class="string">15:34:46 CST message: [k3s-worker-01]</span></span><br><span class="line"><span class="string">downloading image: registry.cn-beijing.aliyuncs.com/kubesphereio/pod2daemon-flexvol:v3.27.4</span></span><br><span class="line"><span class="string">15:34:46 CST success: [k3s-worker-02]</span></span><br><span class="line"><span class="string">15:34:46 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">15:34:46 CST success: [k3s-worker-01]</span></span><br><span class="line"><span class="string">15:34:46 CST [ETCDPreCheckModule] Get etcd status</span></span><br><span class="line"><span class="string">15:34:46 CST stdout: [k3s-master]</span></span><br><span class="line"><span class="string">ETCD_NAME=etcd-k3s-master</span></span><br><span class="line"><span class="string">15:34:46 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">15:34:46 CST [CertsModule] Fetch etcd certs</span></span><br><span class="line"><span class="string">15:34:47 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">15:34:47 CST [CertsModule] Generate etcd Certs</span></span><br><span class="line"><span class="string">[certs] Using existing ca certificate authority</span></span><br><span class="line"><span class="string">[certs] Using existing admin-k3s-master certificate and key on disk</span></span><br><span class="line"><span class="string">[certs] Using existing member-k3s-master certificate and key on disk</span></span><br><span class="line"><span class="string">[certs] Using existing node-k3s-master certificate and key on disk</span></span><br><span class="line"><span class="string">15:34:47 CST success: [LocalHost]</span></span><br><span class="line"><span class="string">15:34:47 CST [CertsModule] Synchronize certs file</span></span><br><span class="line"><span class="string">15:34:50 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">15:34:50 CST [CertsModule] Synchronize certs file to master</span></span><br><span class="line"><span class="string">15:34:50 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">15:34:50 CST [InstallETCDBinaryModule] Install etcd using binary</span></span><br><span class="line"><span class="string">15:34:50 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">15:34:50 CST [InstallETCDBinaryModule] Generate etcd service</span></span><br><span class="line"><span class="string">15:34:50 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">15:34:50 CST [InstallETCDBinaryModule] Generate access address</span></span><br><span class="line"><span class="string">15:34:50 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">15:34:50 CST [ETCDConfigureModule] Health check on exist etcd</span></span><br><span class="line"><span class="string">15:34:50 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">15:34:50 CST [ETCDConfigureModule] Generate etcd.env config on new etcd</span></span><br><span class="line"><span class="string">15:34:50 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">15:34:50 CST [ETCDConfigureModule] Join etcd member</span></span><br><span class="line"><span class="string">15:34:50 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">15:34:50 CST [ETCDConfigureModule] Health check on new etcd</span></span><br><span class="line"><span class="string">15:34:50 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">15:34:50 CST [ETCDConfigureModule] Check etcd member</span></span><br><span class="line"><span class="string">15:34:50 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">15:34:50 CST [ETCDConfigureModule] Refresh etcd.env config on all etcd</span></span><br><span class="line"><span class="string">15:34:50 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">15:34:50 CST [ETCDConfigureModule] Restart etcd</span></span><br><span class="line"><span class="string">15:34:50 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">15:34:50 CST [ETCDConfigureModule] Health check on all etcd</span></span><br><span class="line"><span class="string">15:34:50 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">15:34:50 CST [ETCDBackupModule] Backup etcd data regularly</span></span><br><span class="line"><span class="string">15:34:50 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">15:34:50 CST [ETCDBackupModule] Generate backup ETCD service</span></span><br><span class="line"><span class="string">15:34:50 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">15:34:50 CST [ETCDBackupModule] Generate backup ETCD timer</span></span><br><span class="line"><span class="string">15:34:50 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">15:34:50 CST [ETCDBackupModule] Enable backup etcd service</span></span><br><span class="line"><span class="string">15:34:51 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">15:34:51 CST [InstallKubeBinariesModule] Synchronize kubernetes binaries</span></span><br><span class="line"><span class="string">15:35:00 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">15:35:00 CST skipped: [k3s-worker-01]</span></span><br><span class="line"><span class="string">15:35:00 CST success: [k3s-worker-02]</span></span><br><span class="line"><span class="string">15:35:00 CST [InstallKubeBinariesModule] Change kubelet mode</span></span><br><span class="line"><span class="string">15:35:00 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">15:35:00 CST skipped: [k3s-worker-01]</span></span><br><span class="line"><span class="string">15:35:00 CST success: [k3s-worker-02]</span></span><br><span class="line"><span class="string">15:35:00 CST [InstallKubeBinariesModule] Generate kubelet service</span></span><br><span class="line"><span class="string">15:35:00 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">15:35:00 CST skipped: [k3s-worker-01]</span></span><br><span class="line"><span class="string">15:35:00 CST success: [k3s-worker-02]</span></span><br><span class="line"><span class="string">15:35:00 CST [InstallKubeBinariesModule] Enable kubelet service</span></span><br><span class="line"><span class="string">15:35:01 CST skipped: [k3s-worker-01]</span></span><br><span class="line"><span class="string">15:35:01 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">15:35:01 CST success: [k3s-worker-02]</span></span><br><span class="line"><span class="string">15:35:01 CST [InstallKubeBinariesModule] Generate kubelet env</span></span><br><span class="line"><span class="string">15:35:02 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">15:35:02 CST skipped: [k3s-worker-01]</span></span><br><span class="line"><span class="string">15:35:02 CST success: [k3s-worker-02]</span></span><br><span class="line"><span class="string">15:35:02 CST [JoinNodesModule] Generate kubeadm config</span></span><br><span class="line"><span class="string">15:35:02 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">15:35:02 CST skipped: [k3s-worker-01]</span></span><br><span class="line"><span class="string">15:35:02 CST success: [k3s-worker-02]</span></span><br><span class="line"><span class="string">15:35:02 CST [JoinNodesModule] Generate audit policy</span></span><br><span class="line"><span class="string">15:35:02 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">15:35:02 CST [JoinNodesModule] Generate audit webhook</span></span><br><span class="line"><span class="string">15:35:02 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">15:35:02 CST [JoinNodesModule] Join control-plane node</span></span><br><span class="line"><span class="string">15:35:02 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">15:35:02 CST [JoinNodesModule] Join worker node</span></span><br><span class="line"><span class="string">15:35:17 CST stdout: [k3s-worker-02]</span></span><br><span class="line"><span class="string">[preflight] Running pre-flight checks</span></span><br><span class="line"><span class="string">[preflight] Reading configuration from the cluster...</span></span><br><span class="line"><span class="string">[preflight] FYI: You can look at this config file with &#x27;</span>kubectl -n kube-system get cm kubeadm-config -o yaml<span class="string">&#x27;</span></span><br><span class="line"><span class="string">W1009 15:35:02.987472   10480 utils.go:69] The recommended value for &quot;clusterDNS&quot; in &quot;KubeletConfiguration&quot; is: [10.233.0.10]; the provided value is: [169.254.25.10]</span></span><br><span class="line"><span class="string">[kubelet-start] Writing kubelet configuration to file &quot;/var/lib/kubelet/config.yaml&quot;</span></span><br><span class="line"><span class="string">[kubelet-start] Writing kubelet environment file with flags to file &quot;/var/lib/kubelet/kubeadm-flags.env&quot;</span></span><br><span class="line"><span class="string">[kubelet-start] Starting the kubelet</span></span><br><span class="line"><span class="string">[kubelet-start] Waiting for the kubelet to perform the TLS Bootstrap...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">This node has joined the cluster:</span></span><br><span class="line"><span class="string">* Certificate signing request was sent to apiserver and a response was received.</span></span><br><span class="line"><span class="string">* The Kubelet was informed of the new secure connection details.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Run &#x27;</span>kubectl get nodes<span class="string">&#x27; on the control-plane to see this node join the cluster.</span></span><br><span class="line"><span class="string">15:35:17 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">15:35:17 CST skipped: [k3s-worker-01]</span></span><br><span class="line"><span class="string">15:35:17 CST success: [k3s-worker-02]</span></span><br><span class="line"><span class="string">15:35:17 CST [JoinNodesModule] Copy admin.conf to ~/.kube/config</span></span><br><span class="line"><span class="string">15:35:17 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">15:35:17 CST [JoinNodesModule] Remove master taint</span></span><br><span class="line"><span class="string">15:35:17 CST skipped: [k3s-master]</span></span><br><span class="line"><span class="string">15:35:17 CST [JoinNodesModule] Add worker label to all nodes</span></span><br><span class="line"><span class="string">15:35:18 CST stdout: [k3s-master]</span></span><br><span class="line"><span class="string">node/k3s-master not labeled</span></span><br><span class="line"><span class="string">15:35:18 CST stdout: [k3s-master]</span></span><br><span class="line"><span class="string">node/k3s-worker-01 not labeled</span></span><br><span class="line"><span class="string">15:35:18 CST stdout: [k3s-master]</span></span><br><span class="line"><span class="string">node/k3s-worker-02 labeled</span></span><br><span class="line"><span class="string">15:35:18 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">15:35:18 CST [ConfigureKubernetesModule] Configure kubernetes</span></span><br><span class="line"><span class="string">15:35:18 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">15:35:18 CST [ChownModule] Chown user $HOME/.kube dir</span></span><br><span class="line"><span class="string">15:35:18 CST success: [k3s-worker-02]</span></span><br><span class="line"><span class="string">15:35:18 CST success: [k3s-worker-01]</span></span><br><span class="line"><span class="string">15:35:18 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">15:35:18 CST [AutoRenewCertsModule] Generate k8s certs renew script</span></span><br><span class="line"><span class="string">15:35:18 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">15:35:18 CST [AutoRenewCertsModule] Generate k8s certs renew service</span></span><br><span class="line"><span class="string">15:35:19 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">15:35:19 CST [AutoRenewCertsModule] Generate k8s certs renew timer</span></span><br><span class="line"><span class="string">15:35:19 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">15:35:19 CST [AutoRenewCertsModule] Enable k8s certs renew service</span></span><br><span class="line"><span class="string">15:35:19 CST success: [k3s-master]</span></span><br><span class="line"><span class="string">15:35:19 CST Pipeline[AddNodesPipeline] execute successfully</span></span><br></pre></td></tr></table></figure>

<p>验证集群状态。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt; kubectl get node,cs</span><br><span class="line">Warning: v1 ComponentStatus is deprecated <span class="keyword">in</span> v1.19+</span><br><span class="line">NAME                 STATUS   ROLES                  AGE    VERSION</span><br><span class="line">node/k3s-master      Ready    control-plane,worker   108m   v1.24.17</span><br><span class="line">node/k3s-worker-01   Ready    worker                 20m    v1.24.17</span><br><span class="line">node/k3s-worker-02   Ready    worker                 99s    v1.24.17</span><br><span class="line"></span><br><span class="line">NAME                                 STATUS    MESSAGE                         ERROR</span><br><span class="line">componentstatus/scheduler            Healthy   ok</span><br><span class="line">componentstatus/controller-manager   Healthy   ok</span><br><span class="line">componentstatus/etcd-0               Healthy   &#123;<span class="string">&quot;health&quot;</span>:<span class="string">&quot;true&quot;</span>,<span class="string">&quot;reason&quot;</span>:<span class="string">&quot;&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>查看控制台，Worker 节点成功接入集群。</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/shiyindaxiaojie/images/kubesphere/kubesphere-install-worker.png" loading='lazy'></p>
<p>为方便使用，建议修改 NodePort 的端口范围，在所有服务器节点执行。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; vim /etc/kubernetes/manifests/kube-apiserver.yaml</span><br><span class="line"></span><br><span class="line">  - --service-node-port-range=1-65535</span><br><span class="line">  </span><br><span class="line">&gt; systemctl daemon-reload</span><br><span class="line">&gt; systemctl restart kubelet</span><br></pre></td></tr></table></figure>

<h2 id="创建-NFS-存储类"><a href="#创建-NFS-存储类" class="headerlink" title="创建 NFS 存储类"></a>创建 NFS 存储类</h2><p>在所有服务器节点执行。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">export</span> KUBECONFIG=/etc/kubernetes/admin.conf</span><br><span class="line">&gt; helm repo add nfs-subdir-external-provisioner https://kubernetes-sigs.github.io/nfs-subdir-external-provisioner/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建名为 data-nfs-client 的存储类，用于存储数据</span></span><br><span class="line">&gt; helm install data-nfs-provisioner nfs-subdir-external-provisioner/nfs-subdir-external-provisioner --<span class="built_in">set</span> nfs.server=10.2.1.9 --<span class="built_in">set</span> nfs.path=/nfs/kubesphere/data --<span class="built_in">set</span> replicaCount=3 --<span class="built_in">set</span> storageClass.name=data-nfs-client --<span class="built_in">set</span> storageClass.provisionerName=nfs-data --<span class="built_in">set</span> storageClass.accessModes=ReadWriteMany --<span class="built_in">set</span> nfs.volumeName=data-nfs-root --<span class="built_in">set</span> image.repository=m.daocloud.io/registry.k8s.io/sig-storage/nfs-subdir-external-provisioner</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建名为 log-nfs-client 的存储类，用于存储日志</span></span><br><span class="line">&gt; helm install log-nfs-provisioner nfs-subdir-external-provisioner/nfs-subdir-external-provisioner --<span class="built_in">set</span> nfs.server=10.2.1.9 --<span class="built_in">set</span> nfs.path=/nfs/kubesphere/log --<span class="built_in">set</span> replicaCount=1 --<span class="built_in">set</span> storageClass.name=log-nfs-client --<span class="built_in">set</span> storageClass.provisionerName=nfs-log --<span class="built_in">set</span> storageClass.accessModes=ReadWriteMany --<span class="built_in">set</span> nfs.volumeName=log-nfs-root --<span class="built_in">set</span> image.repository=m.daocloud.io/registry.k8s.io/sig-storage/nfs-subdir-external-provisioner</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建名为 config-nfs-client 的存储类，用于存储配置</span></span><br><span class="line">&gt; helm install config-nfs-provisioner nfs-subdir-external-provisioner/nfs-subdir-external-provisioner --<span class="built_in">set</span> nfs.server=10.2.1.9 --<span class="built_in">set</span> nfs.path=/nfs/kubesphere/config --<span class="built_in">set</span> replicaCount=3 --<span class="built_in">set</span> storageClass.name=config-nfs-client --<span class="built_in">set</span> storageClass.provisionerName=nfs-config --<span class="built_in">set</span> storageClass.accessModes=ReadWriteMany --<span class="built_in">set</span> nfs.volumeName=config-nfs-root --<span class="built_in">set</span> image.repository=m.daocloud.io/registry.k8s.io/sig-storage/nfs-subdir-external-provisioner</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置默认的存储类为数据盘</span></span><br><span class="line">&gt; kubectl patch storageclass data-nfs-client -p <span class="string">&#x27;&#123;&quot;metadata&quot;: &#123;&quot;annotations&quot;:&#123;&quot;storageclass.kubernetes.io/is-default-class&quot;:&quot;true&quot;&#125;&#125;&#125;&#x27;</span></span><br><span class="line">storageclass.storage.k8s.io/data-nfs-client patched</span><br></pre></td></tr></table></figure>

<h2 id="调整镜像仓库配置"><a href="#调整镜像仓库配置" class="headerlink" title="调整镜像仓库配置"></a>调整镜像仓库配置</h2><p><a target="_blank" rel="noopener" href="https://github.com/DaoCloud/public-image-mirror">DaoCloud</a> 提供了 DockerHub 的加速镜像源。如果您无法访问 DockerHub，可以参考以下代码片段进行设置。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 K8s 使用 CONTAINER-TUNTIME 是 containerd:// 还是 docker://</span></span><br><span class="line">&gt; kubectl get nodes -o wide</span><br><span class="line">NAME            STATUS   ROLES                  AGE     VERSION    INTERNAL-IP   EXTERNAL-IP   OS-IMAGE                KERNEL-VERSION                 CONTAINER-RUNTIME</span><br><span class="line">k3s-master      Ready    control-plane,worker   3d23h   v1.24.17   10.2.2.109    &lt;none&gt;        CentOS Linux 7 (Core)   3.10.0-1160.119.1.el7.x86_64   containerd://1.6.33</span><br><span class="line">k3s-worker-01   Ready    worker                 3d22h   v1.24.17   10.2.2.140    &lt;none&gt;        CentOS Linux 7 (Core)   3.10.0-1160.119.1.el7.x86_64   containerd://1.6.33</span><br><span class="line">k3s-worker-02   Ready    worker                 3d22h   v1.24.17   10.2.2.211    &lt;none&gt;        CentOS Linux 7 (Core)   3.10.0-1160.119.1.el7.x86_64   containerd://1.6.33</span><br><span class="line"></span><br><span class="line"><span class="comment"># If use docker</span></span><br><span class="line">&gt; vim /etc/docker/daemon.json</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://docker.m.daocloud.io&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">:wq</span><br><span class="line">&gt; sudo systemctl daemon-reload</span><br><span class="line">&gt; sudo systemctl restart docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># If use containerd</span></span><br><span class="line">&gt; vim /etc/containerd/config.toml</span><br><span class="line"></span><br><span class="line">[plugins]</span><br><span class="line">  [plugins.<span class="string">&quot;io.containerd.grpc.v1.cri&quot;</span>]</span><br><span class="line">    ...</span><br><span class="line">    [plugins.<span class="string">&quot;io.containerd.grpc.v1.cri&quot;</span>.registry]</span><br><span class="line">      [plugins.<span class="string">&quot;io.containerd.grpc.v1.cri&quot;</span>.registry.mirrors]</span><br><span class="line">        [plugins.<span class="string">&quot;io.containerd.grpc.v1.cri&quot;</span>.registry.mirrors.<span class="string">&quot;docker.io&quot;</span>]</span><br><span class="line">          endpoint = [<span class="string">&quot;https://docker.m.daocloud.io&quot;</span>]</span><br><span class="line"></span><br><span class="line">&gt; sudo systemctl daemon-reload</span><br><span class="line">&gt; sudo systemctl restart containerd</span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://github.com/shiyindaxiaojie">梦想歌</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://mengxiangge.netlify.app/2024/10/15/cloudnative/KubeSphere%20%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/">https://mengxiangge.netlify.app/2024/10/15/cloudnative/KubeSphere 高可用集群搭建/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://www.apache.org/licenses/LICENSE-2.0.html" target="_blank">Apache 2.0 License</a> 许可协议。转载请注明来源 <a href="https://mengxiangge.netlify.app" target="_blank">梦想歌の网络日志</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%87%AA%E5%BB%BA%E6%9C%BA%E6%88%BF/">自建机房</a><a class="post-meta__tags" href="/tags/Kubernetes/">Kubernetes</a><a class="post-meta__tags" href="/tags/%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4/">高可用集群</a></div><div class="post-share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/shiyindaxiaojie/images/cover/KubeSphere.png" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/shiyindaxiaojie/images/hexo/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/shiyindaxiaojie/images/hexo/wechat.jpg" alt="微信"/ loading='lazy'></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/shiyindaxiaojie/images/hexo/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/shiyindaxiaojie/images/hexo/alipay.jpg" alt="支付宝"/ loading='lazy'></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2024/10/16/cloudnative/Harbor%20%E7%A7%81%E6%9C%89%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93%E6%90%AD%E5%BB%BA/" title="Harbor 私有镜像仓库搭建"><img class="cover" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/shiyindaxiaojie/images/cover/Harbor.png" onerror="onerror=null;src='https://cdn.jsdelivr.net/gh/shiyindaxiaojie/images/hexo/404.png'" alt="cover of previous post" loading='lazy'><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Harbor 私有镜像仓库搭建</div></div><div class="info-2"><div class="info-item-1">背景由于自建机房无法访问 DockerHub，需要搭建 Harbor 私有镜像仓库，并解决研发团队在本地镜像仓库中拉取镜像的问题。 部署Helm 部署 Harbor本次基于 KubeSphere 平台搭建，使用 Helm 安装，从 ArtifaceHub 搜索 Harbor，添加 Helm Chart。 12export KUBECONFIG=/etc/kubernetes/admin.confhelm repo add harbor https://helm.goharbor.io  Harbor 默认使用 DockerHub 镜像，可以在 Helm 模板添加 m.daocloud.io 镜像仓库前缀，以解决拉取镜像失败的问题。代码片段如下： 123# 存储类指定为 data-nfs-client，您可以自行选择其他存储类。# Harbor 使用 Nginx 提供访问入口，此处设置为 http://10.2.2.109:30003helm upgrade --install harbor harbor/harbor --set expose.type=nodePort --se...</div></div></div></a><a class="pagination-related" href="/2024/09/02/devops/Dockerfile%20%E6%9E%84%E5%BB%BA%20Java%20%E5%BA%94%E7%94%A8%E7%98%A6%E8%BA%AB%E4%BC%98%E5%8C%96/" title="Dockerfile 构建 Java 应用瘦身优化"><img class="cover" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/shiyindaxiaojie/images/cover/Docker.png" onerror="onerror=null;src='https://cdn.jsdelivr.net/gh/shiyindaxiaojie/images/hexo/404.png'" alt="cover of next post" loading='lazy'><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Dockerfile 构建 Java 应用瘦身优化</div></div><div class="info-2"><div class="info-item-1">背景早期我们对于 Docker 构建 Spring Boot 工程的方式很简单，直接构建生成 jar 可执行程序，通过 java $JAVA_OPTS -jar 启动。在 Kubernetes 环境下，如果要调整 JVM 参数，则通过 ConfigMap 维护 JAVA_OPTS 变量，方便统一管理同一个 Nacos 配置中心，如下： 123456-Xmn1G-Xmx1G-Xss256k-Dspring.cloud.nacos.config.username=nacos -Dspring.cloud.nacos.config.password=nacos-Dspring.cloud.nacos.config.server-addr=127.0.0.1:8848   在实际的生产环境，可能定义了十几个甚至上百个 Deployment，每个 Deployment 根据不同的负载设置不同的 JVM 参数，没办法共享同一份 ConfigMap 文件。为了解决这个问题，我们应该优化下 Dockerfile 构建模板，把 JVM 参数和运行环境变量分离出去。 目标制定一套标准 Docker ...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2024/10/16/cloudnative/Harbor%20%E7%A7%81%E6%9C%89%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93%E6%90%AD%E5%BB%BA/" title="Harbor 私有镜像仓库搭建"><img class="cover" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/shiyindaxiaojie/images/cover/Harbor.png" alt="cover" loading='lazy'><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-16</div><div class="info-item-2">Harbor 私有镜像仓库搭建</div></div><div class="info-2"><div class="info-item-1">背景由于自建机房无法访问 DockerHub，需要搭建 Harbor 私有镜像仓库，并解决研发团队在本地镜像仓库中拉取镜像的问题。 部署Helm 部署 Harbor本次基于 KubeSphere 平台搭建，使用 Helm 安装，从 ArtifaceHub 搜索 Harbor，添加 Helm Chart。 12export KUBECONFIG=/etc/kubernetes/admin.confhelm repo add harbor https://helm.goharbor.io  Harbor 默认使用 DockerHub 镜像，可以在 Helm 模板添加 m.daocloud.io 镜像仓库前缀，以解决拉取镜像失败的问题。代码片段如下： 123# 存储类指定为 data-nfs-client，您可以自行选择其他存储类。# Harbor 使用 Nginx 提供访问入口，此处设置为 http://10.2.2.109:30003helm upgrade --install harbor harbor/harbor --set expose.type=nodePort --se...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">背景介绍</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E7%8E%AF%E5%A2%83"><span class="toc-number">2.</span> <span class="toc-text">准备环境</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#DNS-%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">2.1.</span> <span class="toc-text">DNS 初始化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NFS-%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">2.2.</span> <span class="toc-text">NFS 初始化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">2.3.</span> <span class="toc-text">Docker 初始化</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B"><span class="toc-number">3.</span> <span class="toc-text">部署流程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Master-%E8%8A%82%E7%82%B9"><span class="toc-number">3.1.</span> <span class="toc-text">Master 节点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Worker-%E8%8A%82%E7%82%B9"><span class="toc-number">3.2.</span> <span class="toc-text">Worker 节点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-NFS-%E5%AD%98%E5%82%A8%E7%B1%BB"><span class="toc-number">3.3.</span> <span class="toc-text">创建 NFS 存储类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E6%95%B4%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93%E9%85%8D%E7%BD%AE"><span class="toc-number">3.4.</span> <span class="toc-text">调整镜像仓库配置</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url(https://cdn.jsdelivr.net/gh/shiyindaxiaojie/images/cover/KubeSphere.png);"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2020 - 2025 By 梦想歌</span></div><div class="footer_custom_text">下一次相逢会在何时，天空必将见证。</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.1"></script><script src="/js/main.js?v=5.5.1"></script><script src="/js/tw_cn.js?v=5.5.1"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="local-search-input"><input placeholder="输入关键字" type="text"/></div><hr/><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.5.1"></script></div></div>
        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(a){a.imageLazyLoadSetting.processImages=t;var i=a.imageLazyLoadSetting.isSPA,o=a.imageLazyLoadSetting.preloadRatio||1,r=c();function c(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(){i&&(r=c());for(var t,e,n=0;n<r.length;n++)t=r[n],e=void 0,0<=(e=t.getBoundingClientRect()).bottom&&0<=e.left&&e.top<=(a.innerHeight*o||document.documentElement.clientHeight*o)&&function(){var e=r[n];!function(t,e){if(t.hasAttribute("bg-lazy"))return t.removeAttribute("bg-lazy"),e&&e();var n=new Image,a=t.getAttribute("data-original");n.onload=function(){t.src=a,t.removeAttribute("data-original"),e&&e()},t.src!==a&&(n.src=a)}(e,function(){r=r.filter(function(t){return e!==t}),a.imageLazyLoadSetting.onImageLoaded&&a.imageLazyLoadSetting.onImageLoaded(e)})}()}function e(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",e),a.addEventListener("resize",e),a.addEventListener("orientationchange",e)}(this);</script></body></html>